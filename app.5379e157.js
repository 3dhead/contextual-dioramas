!function(t){function e(e){for(var r,a,s=e[0],c=e[1],u=e[2],h=0,f=[];h<s.length;h++)a=s[h],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);for(l&&l(e);f.length;)f.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},o={0:0},i=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;i.push([285,1]),n()}({207:function(t,e){},224:function(t,e){},285:function(t,e,n){"use strict";n.r(e);n(81),n(71),n(92),n(119),n(19),n(124),n(96),n(98),n(14),n(59),n(181),n(182),n(131),n(132),n(74),n(15),n(17),n(101),n(21),n(134),n(186);var r=n(0),o=n(159),i=n(160),a=n.n(i),s=n(161),c=n.n(s),u=n(162),l=n.n(u),h=n(163),f=n.n(h),p=n(164),d=n.n(p),b=n(165),y=n(172),m=n(166),v=n(6),w=n.n(v);function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var O=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tmpVec0=new w.a.Vec3,this.tmpVec1=new w.a.Vec3,this.tmpVec2=new w.a.Vec3,this.tmpQuat0=new w.a.Vec3,this.scene=e,this.world=n,this._meshes=[],this._material=new r.db({color:65280,wireframe:!0}),this._sphereGeometry=new r.Lb(1),this._boxGeometry=new r.h(1,1,1),this._planeGeometry=new r.sb(10,10,10,10),this._cylinderGeometry=new r.s(1,1,10,10)}var e,n,o;return e=t,(n=[{key:"update",value:function(){for(var t=this.world.bodies,e=this._meshes,n=this.tmpVec0,r=this.tmpQuat0,o=0,i=0;i!==t.length;i++)for(var a=t[i],s=0;s!==a.shapes.length;s++){var c=a.shapes[s];this._updateMesh(o,a,c);var u=e[o];u&&(a.quaternion.vmult(a.shapeOffsets[s],n),a.position.vadd(n,n),a.quaternion.mult(a.shapeOrientations[s],r),u.position.copy(n),u.quaternion.copy(r),"visible"in a&&(u.visible=a.visible)),o+=1}for(var l=o;l<e.length;l++){var h=e[l];h&&this.scene.remove(h)}e.length=o}},{key:"_updateMesh",value:function(t,e,n){var r=this._meshes[t];this._typeMatch(r,n)||(r&&this.scene.remove(r),r=this._meshes[t]=this._createMesh(n)),this._scaleMesh(r,n)}},{key:"_createMesh",value:function(t){var e,n=this._material,o=new r.D;switch(t.type){case w.a.Shape.types.SPHERE:e=new r.cb(this._sphereGeometry,n);break;case w.a.Shape.types.BOX:e=new r.cb(this._boxGeometry,n);break;case w.a.Shape.types.PLANE:e=new r.cb(this._planeGeometry,n);break;case w.a.Shape.types.CONVEXPOLYHEDRON:for(var i=0;i<t.vertices.length;i++){var a=t.vertices[i];o.vertices.push(new r.Xb(a.x,a.y,a.z))}for(var s=0;s<t.faces.length;s++)for(var c=t.faces[s],u=c[0],l=1;l<c.length-1;l++){var h=c[l],f=c[l+1];o.faces.push(new r.z(u,h,f))}o.computeBoundingSphere(),o.computeFaceNormals(),e=new r.cb(o,n),t.geometryId=o.id;break;case w.a.Shape.types.TRIMESH:for(var p=0;p<t.indices.length/3;p++){t.getTriangleVertices(p,this.tmpVec0,this.tmpVec1,this.tmpVec2),o.vertices.push(new r.Xb(this.tmpVec0.x,this.tmpVec0.y,this.tmpVec0.z),new r.Xb(this.tmpVec1.x,this.tmpVec1.y,this.tmpVec1.z),new r.Xb(this.tmpVec2.x,this.tmpVec2.y,this.tmpVec2.z));var d=o.vertices.length-3;o.faces.push(new r.z(d,d+1,d+2))}o.computeBoundingSphere(),o.computeFaceNormals(),e=new r.cb(o,n),t.geometryId=o.id;break;case w.a.Shape.types.HEIGHTFIELD:for(var b=0;b<t.data.length-1;b++)for(var y=0;y<t.data[b].length-1;y++)for(var m=0;m<2;m++){t.getConvexTrianglePillar(b,y,0===m),this.tmpVec0.copy(t.pillarConvex.vertices[0]),this.tmpVec1.copy(t.pillarConvex.vertices[1]),this.tmpVec2.copy(t.pillarConvex.vertices[2]),this.tmpVec0.vadd(t.pillarOffset,this.tmpVec0),this.tmpVec1.vadd(t.pillarOffset,this.tmpVec1),this.tmpVec2.vadd(t.pillarOffset,this.tmpVec2),o.vertices.push(new r.Xb(this.tmpVec0.x,this.tmpVec0.y,this.tmpVec0.z),new r.Xb(this.tmpVec1.x,this.tmpVec1.y,this.tmpVec1.z),new r.Xb(this.tmpVec2.x,this.tmpVec2.y,this.tmpVec2.z));var v=o.vertices.length-3;o.faces.push(new r.z(v,v+1,v+2))}o.computeBoundingSphere(),o.computeFaceNormals(),e=new r.cb(o,n),t.geometryId=o.id}return e&&this.scene.add(e),e}},{key:"_typeMatch",value:function(t,e){if(!t)return!1;var n=t.geometry;return n instanceof r.Lb&&e instanceof w.a.Sphere||n instanceof r.h&&e instanceof w.a.Box||n instanceof r.sb&&e instanceof w.a.Plane||n.id===e.geometryId&&e instanceof w.a.ConvexPolyhedron||n.id===e.geometryId&&e instanceof w.a.Trimesh||n.id===e.geometryId&&e instanceof w.a.Heightfield}},{key:"_scaleMesh",value:function(t,e){var n=e.radius;switch(e.type){case w.a.Shape.types.SPHERE:t.scale.set(n,n,n);break;case w.a.Shape.types.BOX:t.scale.copy(e.halfExtents),t.scale.multiplyScalar(2);break;case w.a.Shape.types.CONVEXPOLYHEDRON:t.scale.set(1,1,1);break;case w.a.Shape.types.TRIMESH:t.scale.copy(e.scale);break;case w.a.Shape.types.HEIGHTFIELD:t.scale.set(1,1,1)}}}])&&g(e.prototype,n),o&&g(e,o),t}();function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function j(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function k(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var R=0;function E(t){return"__private_"+R+++"_"+t}var _=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.background,s=void 0===i?"#000":i,c=n.backgroundAlpha,u=void 0===c?1:c,h=n.fov,p=void 0===h?40:h,v=n.near,w=void 0===v?.1:v,g=n.far,P=void 0===g?500:g,R=j(n,["background","backgroundAlpha","fov","near","far"]);if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Object.defineProperty(this,C,{writable:!0,value:[]}),Object.defineProperty(this,D,{writable:!0,value:new r.Xb}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),this.resize=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=void 0===n?e.width:n,o=t.height,i=void 0===o?e.height:o,a=t.pixelRatio,s=void 0===a?e.pixelRatio:a;return e.renderer.getPixelRatio()!==s&&e.renderer.setPixelRatio(s),e.renderer.setSize(r,i),e.camera.isPerspectiveCamera&&(e.camera.aspect=r/i),e.camera.updateProjectionMatrix(),e.composer&&e.composer.setSize(s*r,s*i),e.scene.traverse(function(t){"function"==typeof t.resize&&t.resize({width:r,height:i,pixelRatio:s})}),e.draw(),e},this.saveScreenshot=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=void 0===n?2560:n,o=t.height,i=void 0===o?1440:o,a=t.fileName,s=void 0===a?"image.png":a;e.resize({width:r,height:i,pixelRatio:1}),e.draw();var c=e.canvas.toDataURL("image/png");e.resize(),e.draw(),A(s,c)},this.update=function(t,n,r){return e.orbitControls&&e.orbitControls.update(),e.scene.traverse(function(e){"function"==typeof e.update&&e.update(t,n,r)}),e.world&&(e.world.step(1/60,t),e.cannonDebugRenderer&&e.cannonDebugRenderer.update(),e.world.bodies.forEach(function(e){"function"==typeof e.update&&e.update(t,n)})),k(e,C)[C].forEach(function(e){return e(t,n,r)}),e},this.draw=function(){return e.composer?(e.composer.passes.forEach(function(t,e,n){var r=e===n.length-1;t.renderToScreen=!!r}),e.composer.render()):e.renderer.render(e.scene,e.camera),e},this.start=function(){if(!e.isRunning)return e.renderer.setAnimationLoop(e.animate),e.isRunning=!0,e},this.stop=function(){if(e.isRunning)return e.renderer.setAnimationLoop(null),e.isRunning=!1,e},this.animate=function(t,n){if(e.isRunning){e.stats&&e.stats.begin();var r=Math.min(e.maxDeltaTime,(t-k(e,L)[L])/1e3);e.time+=r,k(e,L)[L]=t,e.update(r,e.time,n),e.draw(),e.stats&&e.stats.end()}},this.traverse=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];e.scene.traverse(function(e){"function"==typeof e[t]&&e[t].apply(e,r)})},this.renderer=new r.bc(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach(function(e){S(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({antialias:!0,alpha:!1,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},R)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=r.nb,this.renderer.sortObjects=!1,this.canvas=this.renderer.domElement,this.renderer.setClearColor(s,u),R.xr&&(this.renderer.xr.enabled=!0),k(this,z)[z]=R.width,k(this,T)[T]=R.height,this.maxPixelRatio=R.maxPixelRatio||2,this.maxDeltaTime=R.maxDeltaTime||1/30,this.camera=new r.pb(p,1,w,P),this.scene=new r.Fb,this.gl=this.renderer.getContext(),this.time=0,this.isRunning=!1,k(this,L)[L]=performance.now(),window.addEventListener("resize",this.resize),window.addEventListener("orientationchange",this.resize),this.resize(),this.touchHandler=a()(this.canvas,{target:this.canvas,filtered:!0}),this.isDragging=!1,this.touchHandler.on("start",function(t,n){e.isDragging=!0,e.traverse("onPointerDown",t,n)}),this.touchHandler.on("move",function(t,n){return e.traverse("onPointerMove",t,n)}),this.touchHandler.on("end",function(t,n){e.isDragging=!1,e.traverse("onPointerUp",t,n)}),R.postprocessing&&(this.composer=new y.a(this.renderer),this.composer.addPass(new m.a(this.scene,this.camera))),R.orbitControls&&(this.camera.position.set(30,20,60),this.orbitControls=new o.a(this.camera,this.renderer.domElement),this.orbitControls.update()),R.world&&(this.world=R.world,R.showWorldWireframes&&(this.cannonDebugRenderer=new O(this.scene,this.world))),R.showFps&&(this.stats=new l.a,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)),R.controls){var E=f()(R.controls);if(this.controls=R.hideControls?E:d()(E,{expanded:!R.closeControls}),!R.hideControls){var _=document.createElement("style");_.type="text/css",_.innerHTML='\n          [class^="controlPanel-"] [class*="__field"]::before {\n            content: initial !important;\n          }\n          [class^="controlPanel-"] [class*="__labelText"] {\n            text-indent: 6px !important;\n          }\n          [class^="controlPanel-"] [class*="__field--button"] > button::before {\n            content: initial !important;\n          }\n        ',document.head.appendChild(_)}}var V=Object(b.getGPUTier)({glContext:this.renderer.getContext()});this.gpu={name:V.type,tier:Number(V.tier.slice(-1)),isMobile:V.tier.toLowerCase().includes("mobile")}}var e,n,i;return e=t,(n=[{key:"onUpdate",value:function(t){k(this,C)[C].push(t)}},{key:"offUpdate",value:function(t){var e=k(this,C)[C].indexOf(t);-1!==e&&k(this,C)[C].splice(e,1)}},{key:"width",get:function(){return k(this,z)[z]||window.innerWidth}},{key:"height",get:function(){return k(this,T)[T]||window.innerHeight}},{key:"pixelRatio",get:function(){return Math.min(this.maxPixelRatio,window.devicePixelRatio)}},{key:"cursor",get:function(){return this.canvas.style.cursor},set:function(t){this.canvas.style.cursor=t||null}}])&&P(e.prototype,n),i&&P(e,i),t}(),C=E("updateListeners"),D=E("tmpTarget"),L=E("lastTime"),z=E("width"),T=E("height");function A(t,e){var n=c()(e),r=document.createElement("a");r.download=t,r.href=window.URL.createObjectURL(n),r.onclick=setTimeout(function(){window.URL.revokeObjectURL(n),r.removeAttribute("href")},0),r.click()}n(25),n(26),n(75),n(196),n(76),n(197),n(46),n(105),n(27),n(106);var V=n(167),M=n.n(V),I=n(80),X=n.n(I),U=n(78),H=n(168),B=n(79);n(209);function W(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function N(t,e){return G.apply(this,arguments)}function G(){var t;return t=regeneratorRuntime.mark(function t(e,n){var o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(o=new r.Qb).name=e,o.encoding=n.encoding||r.R,q(e,o,n),t.prev=4,t.next=7,Object(U.a)(e,{crossorigin:"anonymous"});case 7:return i=t.sent,o.image=i,o.needsUpdate=!0,n.renderer&&n.renderer.initTexture(o),t.abrupt("return",o);case 14:throw t.prev=14,t.t0=t.catch(4),new Error("Could not load texture ".concat(e));case 17:case"end":return t.stop()}},t,null,[[4,14]])}),(G=function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){W(i,r,o,a,s,"next",t)}function s(t){W(i,r,o,a,s,"throw",t)}a(void 0)})}).apply(this,arguments)}function q(t,e,n){if("boolean"==typeof n.flipY&&(e.flipY=n.flipY),void 0!==n.mapping&&(e.mapping=n.mapping),void 0!==n.format)e.format=n.format;else{var o=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data:image\/jpeg/);e.format=o?r.Cb:r.zb}n.repeat&&e.repeat.copy(n.repeat),e.wrapS=n.wrapS||r.n,e.wrapT=n.wrapT||r.n,e.minFilter=n.minFilter||r.T,e.magFilter=n.magFilter||r.S,e.generateMipmaps=!1!==n.generateMipmaps}n(211);var F=n(169),Q=n.n(F),$=n(170);function Y(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function J(){var t;return t=regeneratorRuntime.mark(function t(e,n){var o,i,a,s,c,u,l,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.renderer){t.next=3;break}throw new Error("Env map requires renderer to passed in the options for ".concat(e,"!"));case 3:if(!n.equirectangular){t.next=17;break}return t.next=6,N(e,{renderer:o});case 6:if(i=t.sent,!n.pmrem){t.next=11;break}return t.abrupt("return",K(i,o));case 11:return a=Q()(i.image.naturalHeight),s=new r.Zb(a,{generateMipmaps:!0,minFilter:r.U,magFilter:r.S}),c=s.fromEquirectangularTexture(o,i),i.dispose(),i.image.data=null,t.abrupt("return",c);case 17:if(u=e,l=n.extension||".jpg",f="".concat(u.replace(/\/$/,""),"/"),p=l,h=["".concat(f,"px").concat(p),"".concat(f,"nx").concat(p),"".concat(f,"py").concat(p),"".concat(f,"ny").concat(p),"".concat(f,"pz").concat(p),"".concat(f,"nz").concat(p)],".hdr"!==l){t.next=22;break}return t.abrupt("return",new Promise(function(t,e){(new $.a).load(r.Vb,h,function(e){return t(Z(e,n))},null,function(){return e(new Error("Could not load env map: ".concat(u)))})}));case 22:return t.abrupt("return",new Promise(function(t,e){(new r.r).load(h,function(e){return t(Z(e,n))},null,function(){return e(new Error("Could not load env map: ".concat(u)))})}));case 23:case"end":return t.stop()}var f,p},t)}),(J=function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){Y(i,r,o,a,s,"next",t)}function s(t){Y(i,r,o,a,s,"throw",t)}a(void 0)})}).apply(this,arguments)}function Z(t,e){return e.encoding&&(t.encoding=e.encoding),e.format&&(t.format=e.format),e.pmrem&&(t=function(t,e){var n=new r.ob(e);n.compileCubemapShader();var o=n.fromCubemap(t);return n.dispose(),t.dispose(),t.image.data=null,o.texture}(t,e.renderer)),t}function K(t,e){var n=new r.ob(e);n.compileEquirectangularShader();var o=n.fromEquirectangular(t);return n.dispose(),t.dispose(),t.image.data=null,o.texture}function tt(t){return function(t){if(Array.isArray(t))return et(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return et(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return et(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nt(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function rt(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){nt(i,r,o,a,s,"next",t)}function s(t){nt(i,r,o,a,s,"throw",t)}a(void 0)})}}function ot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(n),!0).forEach(function(e){at(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function at(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function st(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ut(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var lt=0;function ht(t){return"__private_"+lt+++"_"+t}var ft=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Object.defineProperty(this,pt,{writable:!0,value:[]}),Object.defineProperty(this,dt,{writable:!0,value:{}}),Object.defineProperty(this,bt,{writable:!0,value:[]}),Object.defineProperty(this,yt,{writable:!0,value:10}),Object.defineProperty(this,mt,{writable:!0,value:[]}),this.get=function(t){if(!t)throw new TypeError("Must specify an URL for AssetManager.get()");return ut(e,dt)[dt][t]}}var e,n,r,o,i;return e=t,(n=[{key:"addProgressListener",value:function(t){if("function"!=typeof t)throw new TypeError("onProgress must be a function");ut(this,bt)[bt].push(t)}},{key:"queue",value:function(t){var e=t.url,n=t.type,r=st(t,["url","type"]);if(!e)throw new TypeError("Must specify a URL or opt.url for AssetManager.queue()");return this._getQueued(e)||ut(this,pt)[pt].push(it({url:e,type:n||this._extractType(e)},r)),e}},{key:"_getQueued",value:function(t){return ut(this,pt)[pt].find(function(e){return e.url===t})}},{key:"_extractType",value:function(t){var e=t.slice(t.lastIndexOf("."));switch(!0){case/\.(gltf|glb)$/i.test(e):return"gltf";case/\.(hdri|hdr)$/i.test(e):return"hdri";case/\.json$/i.test(e):return"json";case/\.svg$/i.test(e):return"svg";case/\.(jpe?g|png|gif|bmp|tga|tif)$/i.test(e):return"image";case/\.(wav|mp3)$/i.test(e):return"audio";case/\.(mp4|webm|ogg|ogv)$/i.test(e):return"video";default:throw new Error("Could not load ".concat(t,", unknown file extension!"))}}},{key:"loadSingle",value:(i=rt(regeneratorRuntime.mark(function t(e){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.renderer,r=st(e,["renderer"]),n){t.next=3;break}throw new Error("You must provide a renderer to the loadSingle function.");case 3:return t.prev=3,o=Date.now(),t.next=7,this._loadItem(it({renderer:n},r));case 7:return ut(this,dt)[dt][r.url]=t.sent,window.DEBUG&&console.log("\ud83d\udce6 Loaded single asset %c".concat(r.url,"%c in ").concat(X()(Date.now()-o)),"color:blue","color:black"),t.abrupt("return",r.url);case 12:t.prev=12,t.t0=t.catch(3),delete ut(this,dt)[dt][r.url],console.error("\ud83d\udce6 Asset ".concat(r.url," was not loaded:\n").concat(t.t0));case 16:case"end":return t.stop()}},t,this,[[3,12]])})),function(t){return i.apply(this,arguments)})},{key:"load",value:(o=rt(regeneratorRuntime.mark(function t(e){var n,r,o,i,a,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.renderer){t.next=3;break}throw new Error("You must provide a renderer to the load function.");case 3:if(r=ut(this,pt)[pt].slice(),ut(this,pt)[pt].length=0,0!==(o=r.length)){t.next=9;break}return setTimeout(function(){return ut(s,bt)[bt].forEach(function(t){return t(1)})},0),t.abrupt("return");case 9:return i=Date.now(),t.next=12,M()(r,function(){var t=rt(regeneratorRuntime.mark(function t(e,r){var i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=Date.now(),t.next=4,s._loadItem(it({renderer:n},e));case 4:ut(s,dt)[dt][e.url]=t.sent,window.DEBUG&&s.log("Loaded %c".concat(e.url,"%c in ").concat(X()(Date.now()-i)),"color:blue","color:black"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),s.logError("Asset ".concat(e.url," was not loaded:\n").concat(t.t0));case 11:a=(r+1)/o,ut(s,bt)[bt].forEach(function(t){return t(a)});case 13:case"end":return t.stop()}},t,null,[[0,8]])}));return function(e,n){return t.apply(this,arguments)}}(),{concurrency:ut(this,yt)[yt]});case 12:window.DEBUG&&(0===(a=ut(this,mt)[mt].filter(function(t){return"error"===t.type})).length?this.groupLog("\ud83d\udce6 Assets loaded in ".concat(X()(Date.now()-i)," \u23f1")):this.groupLog("\ud83d\udce6 %c Could not load ".concat(a.length," asset").concat(a.length>1?"s":""," "),"color:white;background:red;"));case 13:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"_loadItem",value:function(t){var e=t.url,n=t.type,r=t.renderer,o=st(t,["url","type","renderer"]);if(e in ut(this,dt)[dt])return ut(this,dt)[dt][e];switch(n){case"gltf":return new Promise(function(t,n){(new H.a).load(e,t,null,function(t){return n(new Error("Could not load GLTF asset ".concat(e,":\n").concat(t)))})});case"hdri":return new Promise(function(t,n){(new B.a).load(e,t,null,function(t){return n(new Error("Could not load HDRI asset ".concat(e,":\n").concat(t)))})});case"json":return fetch(e).then(function(t){return t.json()});case"env-map":return function(t,e){return J.apply(this,arguments)}(e,it({renderer:r},o));case"svg":case"image":return Object(U.a)(e,{crossorigin:"anonymous"});case"texture":return N(e,it({renderer:r},o));case"audio":return fetch(e).then(function(t){return t.arrayBuffer()});case"video":return fetch(e).then(function(t){return t.blob()});default:throw new Error("Could not load ".concat(e,", the type ").concat(n," is unknown!"))}}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];ut(this,mt)[mt].push({type:"log",text:e})}},{key:"logError",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];ut(this,mt)[mt].push({type:"error",text:e})}},{key:"groupLog",value:function(){var t;(t=console).groupCollapsed.apply(t,arguments),ut(this,mt)[mt].forEach(function(t){var e;(e=console)[t.type].apply(e,tt(t.text))}),console.groupEnd(),ut(this,mt)[mt].length=0}}])&&ct(e.prototype,n),r&&ct(e,r),t}(),pt=ht("queue"),dt=ht("cache"),bt=ht("onProgressListeners"),yt=ht("asyncConcurrency"),mt=ht("logs"),vt=new ft,wt=(n(144),n(145),n(38),n(33),n(34),n(28));function gt(t){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function xt(t,e){return(xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Pt(t);if(e){var o=Pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return jt(this,n)}}function jt(t,e){return!e||"object"!==gt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xt(t,e)}(s,r["E"]);var e,o,i,a=St(s);function s(t,e){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(o=a.call(this,e)).type="ContextualObject",o.webgl=t,o.options=e;var i=n(53);return o.rng=i(o.options.seed),!0===o.constructor.hasOwnProperty("randomAngle")&&o.setRotationFromEuler(new r.x(2*(o.rng()-.5)*Object(wt.degToRad)(o.constructor.randomAngle.x),2*(o.rng()-.5)*Object(wt.degToRad)(o.constructor.randomAngle.y),2*(o.rng()-.5)*Object(wt.degToRad)(o.constructor.randomAngle.z))),o}return e=s,(o=[{key:"addMesh",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;e.color.r+=(this.rng()-.5)*n,e.color.g+=(this.rng()-.5)*n,e.color.b+=(this.rng()-.5)*n,void 0===e.roughness&&(e.roughness=.6),e.roughness+=(this.rng()-.5)*n;var o=new r.eb(e),i=new r.cb(t,o);i.castShadow=!0,i.receiveShadow=!0,this.add(i)}}])&&Ot(e.prototype,o),i&&Ot(e,i),s}();function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Et(t,e){return(Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Dt(t);if(e){var o=Dt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ct(this,n)}}function Ct(t,e){return!e||"object"!==Rt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Dt(t){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}kt.className=null,kt.distributionOptions={},kt.labels=[],kt.baseDensity=0,kt.randomAngle=new r.Xb(0,0,0),kt.sizeVariation=.5,kt.allowUnderwater=!1;var Lt=vt.queue({url:"models/house_swedish_01.glb",type:"gltf"}),zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Et(t,e)}(n,kt);var e=_t(n);function n(t,r){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=e.call(this,t,r)).type="Building";var i=vt.get(Lt).scene.clone();return i.traverse(function(t){t.isMesh&&(t.castShadow=!0,t.receiveShadow=!0)}),o.add(i),o}return n}();function Tt(t){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=It(t);if(e){var o=It(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Mt(this,n)}}function Mt(t,e){return!e||"object"!==Tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function It(t){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}zt.className="Building",zt.distributionOptions={ground:1},zt.labels=["building"],zt.baseDensity=.001,zt.randomAngle=new r.Xb(0,180,0);var Xt=vt.queue({url:"models/cactus_01.glb"}),Ut=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}(n,kt);var e=Vt(n);function n(t,r){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=e.call(this,t,r)).type="Cactus";var i=vt.get(Xt).scene.clone();i.traverse(function(t){t.isMesh&&(t.material=t.material.clone(),t.material.color.r+=.1*(o.rng()-.5),t.material.color.g+=.1*(o.rng()-.5),t.material.color.b+=.1*(o.rng()-.5),t.castShadow=!0,t.receiveShadow=!0)});var a=(o.rng()-.5)*o.constructor.sizeVariation;return o.scale.x+=a,o.scale.y+=a,o.scale.z+=a,o.add(i),o}return n}();function Ht(t){return(Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Gt(t);if(e){var o=Gt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Nt(this,n)}}function Nt(t,e){return!e||"object"!==Ht(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Gt(t){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Ut.className="Cactus",Ut.distributionOptions={ground:1},Ut.labels=["vegetation","cactus"],Ut.baseDensity=.015,Ut.randomAngle=new r.Xb(4,180,4),Ut.baseHeight=5;var qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bt(t,e)}(n,kt);var e=Wt(n);function n(t,o){var i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=e.call(this,t,o)).type="Rock",i.size=i.constructor.baseSize+(i.rng()-.5)*i.constructor.baseSize*i.constructor.sizeVariation;var a=new r.Lb(i.size,4,4),s=new r.p(.4,.36,.32);null!==i.options.terrainColor&&s.lerp(i.options.terrainColor,.5);var c=!0===i.options.isUnderwater?.4:.6;return i.addMesh(a,{color:s,roughness:c},.05),i}return n}();function Ft(t){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qt(t,e){return(Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Jt(t);if(e){var o=Jt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Yt(this,n)}}function Yt(t,e){return!e||"object"!==Ft(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Jt(t){return(Jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}qt.className="Rock",qt.distributionOptions={shoreline:1,ground:.2},qt.labels=["rock"],qt.baseDensity=.1,qt.randomAngle=new r.Xb(15,90,15),qt.baseSize=1,qt.allowUnderwater=!0;var Zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qt(t,e)}(n,kt);var e=$t(n);function n(t,o){var i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=e.call(this,t,o)).type="Tree",i.height=i.constructor.baseHeight+(i.rng()-.5)*i.constructor.baseHeight*i.constructor.sizeVariation;var a=.1+.1*i.rng(),s=new r.s(.01,.25*i.height,i.height,32,4,!1);s.translate(0,i.height*(.5+a),0);var c=new r.p(.15,.24,.12);i.addMesh(s,{color:c},.05);var u=.05*i.height;return(s=new r.s(u,u,i.height/4,32,1,!0)).translate(0,i.height*a/2,0),c=new r.p(.28,.21,.12),i.addMesh(s,{color:c}),i}return n}();Zt.className="Tree",Zt.distributionOptions={ground:1},Zt.labels=["vegetation","tree"],Zt.baseDensity=.025,Zt.randomAngle=new r.Xb(4,0,4),Zt.baseHeight=7;var Kt={temperate:{assets:[zt,Zt,qt],terrain:{ground:new r.p(.19,.35,.11),shoreline:new r.p(.41,.31,.15),cliff:new r.p(.28,.31,.29),underwater:new r.p(.05,.08,.08),side:new r.p(.42,.37,.26)},water:{color:new r.p(.05,.06,.04),opacity:.83}},desert:{assets:[Ut,qt],terrain:{ground:new r.p(.44,.24,.14),shoreline:new r.p(.56,.37,.24),cliff:new r.p(.34,.19,.12),underwater:new r.p(.05,.08,.08),side:new r.p(.41,.28,.21)},water:{color:new r.p(.08,.15,.11),opacity:.75}},arctic:{assets:[Zt,qt],terrain:{ground:new r.p(.82,.84,.88),shoreline:new r.p(.55,.51,.47),cliff:new r.p(.24,.26,.26),underwater:new r.p(.05,.08,.08),side:new r.p(.31,.24,.18)},water:{color:new r.p(.04,.05,.03),opacity:.81}}};function te(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ee(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var re=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.webgl=e,this.bounds=n,this.boundsSize=new r.Wb(0,0),this.bounds.getSize(this.boundsSize),this.labels={},this.color=null,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}var e,n,o;return e=t,(n=[{key:"isSmallestAllowedSize",value:function(){return this.boundsSize.x<=2&&this.boundsSize.y<=2}},{key:"setColor",value:function(e,n){var o=this.getPoint(n);if(!1!==this.bounds.containsPoint(o))if(!0!==this.isSmallestAllowedSize()){var i=(this.bounds.min.x+this.bounds.max.x)/2,a=(this.bounds.min.y+this.bounds.max.y)/2;i>=o.x?a>=o.y?(null===this.topLeft&&(this.topLeft=new t(this.webgl,new r.e(this.bounds.min,this.bounds.min.clone().add(this.bounds.max).multiplyScalar(.5)))),this.topLeft.setColor(e,o)):(null===this.bottomLeft&&(this.bottomLeft=new t(this.webgl,new r.e(new r.Wb(this.bounds.min.x,(this.bounds.min.y+this.bounds.max.y)/2),new r.Wb((this.bounds.min.x+this.bounds.max.x)/2,this.bounds.max.y)))),this.bottomLeft.setColor(e,o)):a>=o.y?(null===this.topRight&&(this.topRight=new t(this.webgl,new r.e(new r.Wb((this.bounds.min.x+this.bounds.max.x)/2,this.bounds.min.y),new r.Wb(this.bounds.max.x,(this.bounds.min.y+this.bounds.max.y)/2)))),this.topRight.setColor(e,o)):(null===this.bottomRight&&(this.bottomRight=new t(this.webgl,new r.e(this.bounds.min.clone().add(this.bounds.max).multiplyScalar(.5),this.bounds.max))),this.bottomRight.setColor(e,o))}else this.color=e;else console.warn("setColor: Bounds did not contain position [".concat(n.x,", ").concat(n.y,"]!"))}},{key:"getColor",value:function(t){var e=this.getPoint(t);if(!0===this.bounds.containsPoint(e)){if(!0===this.isSmallestAllowedSize())return this.color;for(var n=0,r=[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft];n<r.length;n++){var o=r[n];if(null!==o&&!0===o.bounds.containsPoint(e))return o.getColor(e)}}else console.warn("getColor: Bounds did not contain position [".concat(e.x,", ").concat(e.y,"]!"));return window.DEBUG&&this.drawDebug(16711935),null}},{key:"getAverageColor",value:function(t){var e=this.getPoint(t),n=this.getColor(e);if(null===n)return null;for(var o=0,i=0,a=0,s=0,c=[-1,0,1],u=0,l=c;u<l.length;u++){var h,f=l[u],p=te(c);try{for(p.s();!(h=p.n()).done;){var d=h.value,b=n;if(0!=f&&0!=d){var y=new r.Wb(e.x+2*f,e.y+2*d);!0===this.bounds.containsPoint(y)&&(b=this.getColor(y)),null===b&&(b=n)}o+=b.r,i+=b.g,a+=b.b,s++}}catch(t){p.e(t)}finally{p.f()}}return new r.p((n.r+o)/s,(n.g+i)/s,(n.b+a)/s)}},{key:"addLabels",value:function(e,n){var o=this.getPoint(n);if(!1!==this.bounds.containsPoint(o)){var i,a=te(e);try{for(a.s();!(i=a.n()).done;){var s=i.value;s in this.labels?this.labels[s]+=1:this.labels[s]=1}}catch(t){a.e(t)}finally{a.f()}if(!this.isSmallestAllowedSize()){var c=(this.bounds.min.x+this.bounds.max.x)/2,u=(this.bounds.min.y+this.bounds.max.y)/2;c>=o.x?u>=o.y?(null===this.topLeft&&(this.topLeft=new t(this.webgl,new r.e(this.bounds.min,this.bounds.min.clone().add(this.bounds.max).multiplyScalar(.5)))),this.topLeft.addLabels(e,o)):(null===this.bottomLeft&&(this.bottomLeft=new t(this.webgl,new r.e(new r.Wb(this.bounds.min.x,(this.bounds.min.y+this.bounds.max.y)/2),new r.Wb((this.bounds.min.x+this.bounds.max.x)/2,this.bounds.max.y)))),this.bottomLeft.addLabels(e,o)):u>=o.y?(null===this.topRight&&(this.topRight=new t(this.webgl,new r.e(new r.Wb((this.bounds.min.x+this.bounds.max.x)/2,this.bounds.min.y),new r.Wb(this.bounds.max.x,(this.bounds.min.y+this.bounds.max.y)/2)))),this.topRight.addLabels(e,o)):(null===this.bottomRight&&(this.bottomRight=new t(this.webgl,new r.e(this.bounds.min.clone().add(this.bounds.max).multiplyScalar(.5),this.bounds.max))),this.bottomRight.addLabels(e,o))}}else console.warn("addLabels: Bounds did not contain position [".concat(o.x,", ").concat(o.y,"]!"))}},{key:"findQuadWithMinLabelDensity",value:function(t,e){var n=this.getLabelDensity(t);if(n<=0)return null;if(n>=e)return this;if(t in this.labels){var r=null,o=0,i=0;return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft].forEach(function(e){null!==e&&(i=e.getLabelDensity(t))>o&&(r=e,o=i)}),r.findQuadWithMinLabelDensity(t,e)}return null}},{key:"findQuadWithMaxLabelDensity",value:function(t,e){var n=this.getLabelDensity(t);if(n<=e)return console.log("Found quad with density ".concat(n," for ").concat(t)),this;if(console.log("This one had ".concat(n," for ").concat(t,", looking in children")),t in this.labels){var r=null,o=e,i=0;return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft].forEach(function(e){null!==e&&(i=e.getLabelDensity(t))<o&&(r=e,o=i)}),r.findQuadWithMaxLabelDensity(t,e)}return null}},{key:"getLabelDensity",value:function(t){return t in this.labels==!0?this.labels[t]/(this.boundsSize.x*this.boundsSize.y):0}},{key:"hasLabels",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=te(t);try{for(r.s();!(e=r.n()).done;){var o=e.value,i=o in this.labels==!0;if(!0===n&&!1===i)return!1;if(!1===n&&!0===i)return!0}}catch(t){r.e(t)}finally{r.f()}return!0}},{key:"positionHasLabels",value:function(t,e){if(!1===Array.isArray(e))return!1;var n=this.getPoint(t);if(!1===this.bounds.containsPoint(n)||!1===this.hasLabels(e))return!1;for(var r=0,o=[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft];r<o.length;r++){var i=o[r];if(null!==i&&i.bounds.containsPoint(n))return i.positionHasLabels(n,e)}return!0}},{key:"getLabels",value:function(t){var e=this.getPoint(t);if(!1===this.bounds.containsPoint(e))return[];if(!0===this.isSmallestAllowedSize())return this.labels;for(var n=0,r=[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft];n<r.length;n++){var o=r[n];if(null!==o&&o.bounds.containsPoint(e))return o.getLabels(e)}return this.labels}},{key:"getPoint",value:function(t){return hasOwnProperty.call(t,"z")?new r.Wb(t.x,t.z):t}},{key:"drawDebug",value:function(t){var e=new r.f,n=new r.Xb((this.bounds.min.x+this.bounds.max.x)/2,10,(this.bounds.min.y+this.bounds.max.y)/2),o=new r.Xb(this.boundsSize.x,1,this.boundsSize.y);e.setFromCenterAndSize(n,o);var i=new r.g(e,t);this.webgl.scene.add(i)}}])&&ne(e.prototype,n),o&&ne(e,o),t}(),oe=(n(225),n(227),n(230),n(235),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(171));function ie(t,e,n,o,i,a){var s=e.getAttribute("position").array;e.computeBoundingBox();var c=new r.Xb(0,0,0);e.boundingBox.getSize(c);for(var u=0,l=0;l<4;l++){var h=l%2==1,f=new r.rb(h?c.x:c.z,h?c.z:c.x,h?o:i,1);h?f.translate(0,0,c.z/2):(f.rotateY(-Math.PI/2),f.translate(-c.x/2,0,0));for(var p=f.getAttribute("position").array,d=h?o:i,b=0,y=p.length/3/2;b<y;b++)u=h?l<2?s[3*(b+(o+1)*i)+1]:s[3*b+1]:l<2?s[b*(o+1)*3+1]:s[3*(b*(o+1)+o)+1],p[3*b+1]=u,p[3*(b+d+1)+1]=a;var m=new r.cb(f,n);l>1&&(h?m.scale.z=-1:m.scale.x=-1),m.castShadow=!0,m.receiveShadow=!0,t.add(m)}}function ae(t){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ce(t,e){return(ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ue(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=fe(t);if(e){var o=fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return le(this,n)}}function le(t,e){return!e||"object"!==ae(e)&&"function"!=typeof e?he(t):e}function he(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fe(t){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pe(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var de=0;var be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ce(t,e)}(s,r["E"]);var e,o,i,a=ue(s);function s(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),n=a.call(this,e),Object.defineProperty(he(n),ye,{writable:!0,value:2}),n.type="Terrain",n.webgl=t,n.options=e,n.generateHeight(n.options.bounds.x,n.options.bounds.z);var o=new r.rb(n.options.bounds.x,n.options.bounds.z,n.options.bounds.x-1,n.options.bounds.z-1);o.rotateX(-Math.PI/2);for(var i=o.getAttribute("position").array,c=0,u=i.length/3;c<u;c++)i[3*c+1]=n.heightData[c];!0===n.options.water.enabled&&(n.waterCurve=n.getWaterCurve(o),n.modifyGeometryForWater(o)),o.computeVertexNormals();var l=new r.l(n.generateTexture(o,n.options.bounds.x,n.options.bounds.z));l.wrapS=r.n,l.wrapT=r.n;var h=new r.eb({map:l,roughness:.7});n.mesh=new r.cb(o,h),n.mesh.castShadow=!0,n.mesh.receiveShadow=!0,n.add(n.mesh);var f=new r.eb({color:Kt[n.options.biome.name].terrain.side,roughness:.6});return ie(he(n),o,f,n.options.bounds.x-1,n.options.bounds.z-1,-n.options.bounds.y/2),n}return e=s,(o=[{key:"generateHeight",value:function(t,e){var r=t*e,o=new oe.a,i=1,a=n(53)(this.options.seed)();this.heightData=new Float32Array(r);for(var s=0;s<4;s++){for(var c=0;c<r;c++){var u=c%t,l=~~(c/t);this.heightData[c]+=Math.abs(o.noise(u/i,l/i,a)*i*1.75)}i*=5}for(var h=1e4,f=-1e4,p=0;p<r;p++)this.heightData[p]<h&&(h=this.heightData[p]),this.heightData[p]>f&&(f=this.heightData[p]);for(var d=(this.options.bounds.y-pe(this,ye)[ye]-2)/this.options.bounds.y,b=this.options.bounds.y/f,y=0;y<r;y++)this.heightData[y]=((this.heightData[y]-h)*b-.5*this.options.bounds.y+pe(this,ye)[ye])*d}},{key:"generateTexture",value:function(t,e,o){var i,a,s,c;(i=document.createElement("canvas")).width=e,i.height=o,(a=i.getContext("2d")).fillStyle="#000",a.fillRect(0,0,e,o),c=(s=a.getImageData(0,0,i.width,i.height)).data;for(var u=n(53)(this.options.seed),l=this.options.bounds.y/2,h=Object(wt.lerp)(-l,l,this.options.water.level),f=t.getAttribute("position").array,p=t.getAttribute("normal").array,d=Kt[this.options.biome.name].terrain.ground.clone().add(new r.p(.05*u(),.05*u(),.05*u())),b=Kt[this.options.biome.name].terrain.shoreline.clone().add(new r.p(.05*u(),.05*u(),.05*u())),y=Kt[this.options.biome.name].terrain.cliff.clone().add(new r.p(.05*u(),.05*u(),.05*u())),m=Kt[this.options.biome.name].terrain.underwater.clone().add(new r.p(.05*u(),.05*u(),.05*u())),v=new r.Xb(0,1,0),w=0,g=f.length/3;w<g;w++){var O=d.clone(),x=["ground"];if(this.options.water.enabled){var S=f[3*w+1];if(S<h&&(O=m.clone(),x=["shoreline"]),!0===this.options.water.shoreline.enabled){var j=this.options.water.shoreline.width+this.options.water.shoreline.falloff;if(S<=h-this.options.water.shoreline.width){var P=Math.clamp(S/(h-S),0,1);O.lerp(b,P)}else if(j>.001)if(S<=h+this.options.water.shoreline.width)O=b.clone(),x=["shoreline"];else if(this.options.water.shoreline.falloff>.001){var k=Math.clamp((S-h-this.options.water.shoreline.width)/this.options.water.shoreline.falloff,0,1);O=b.clone().lerp(d,k),k<=.33?x=["shoreline"]:k<=.67&&x.push("shoreline")}}}var R=new r.Xb(p[3*w],p[3*w+1],p[3*w+2]),E=1-Math.abs(R.dot(v));if(E>.15){var _=Math.min(1,(E-.15)/(.2-.15));O.lerp(y,_),_>=.67?x=["cliff"]:_>.33&&x.push("cliff")}o<h&&(x.push=["water"]),c[4*w]=255*O.r*(1-.1*u()),c[4*w+1]=255*O.g*(1-.1*u()),c[4*w+2]=255*O.b*(1-.1*u());var C=new r.Wb(f[3*w],f[3*w+2]);this.options.contextQuadtree.addLabels(x,C),this.options.contextQuadtree.setColor(O,C)}a.putImageData(s,0,0);var D=document.createElement("canvas");D.width=4*e,D.height=4*o,(a=D.getContext("2d")).scale(4,4),a.drawImage(i,0,0);for(var L=0,z=(c=(s=a.getImageData(0,0,D.width,D.height)).data).length;L<z;L+=4){var T=~~(8*(u()-.5));c[L]+=T,c[L+1]+=T,c[L+2]+=T}return a.putImageData(s,0,0),D}},{key:"modifyGeometryForWater",value:function(t){for(var e=this.waterCurve.getPoints(10),n=t.getAttribute("position").array,o=new r.Xb(0,0,0),i=new r.Xb(0,0,0),a=0,s=n.length/3;a<s;a++){for(var c=new r.Xb(n[3*a],n[3*a+1],n[3*a+2]),u=new r.Wb(c.x,c.z),l=1e5,h=0;h<e.length-1;h++){new r.N(e[h],e[h+1]).closestPointToPoint(c,!0,o);var f=u.distanceTo(new r.Wb(o.x,o.z));f<l&&(l=f,i=o.clone())}var p=u.distanceTo(new r.Wb(i.x,i.z));p<this.options.water.width/2+this.options.water.falloff&&(n[3*a+1]=this.getWaterVertexHeight(p,i.y,n[3*a+1]))}}},{key:"getWaterVertexHeight",value:function(t,e,n){var r=Math.clamp((t-this.options.water.width/2)/this.options.water.falloff,0,1),o=Object(wt.lerp)(e-this.options.water.depth,n,r),i=-this.options.bounds.y/2+1;return Math.max(i,o)}},{key:"getRandomPointOnTerrain",value:function(){var t=new r.Db,e=new r.Xb(this.rng(),0,this.rng());e.multiply(this.options.bounds),e.y=this.options.bounds.y,e.sub(new r.Xb(.5,.5,.5).multiply(this.options.bounds)),t.set(e,new r.Xb(0,-1,0));var n=t.intersectObject(this.mesh);return n.length>0?{hit:!0,position:n[0].point}:{hit:!1,position:null}}},{key:"getWaterCurve",value:function(t){for(var e=[new r.Xb(0,1e5,0),new r.Xb(0,1e5,0)],n=new r.Xb,o=t.getAttribute("position").array,i=Math.min(this.options.bounds.x,this.options.bounds.z)/4,a=0;a<o.length/3;a++)for(var s=0;s<e.length;s++)if(n.x=o[3*a],n.y=o[3*a+1],n.z=o[3*a+2],n.y<e[s].y&&(0==s||n.distanceTo(e[s-1])>i)){e[s].x=n.x,e[s].y=n.y,e[s].z=n.z;break}var c=this.options.bounds.x/2,u=this.options.bounds.z/2,l=new r.N(e[0].clone().add(e[1].clone().sub(e[0]).multiplyScalar(-10)),e[0].clone().add(e[1].clone().sub(e[0]).multiplyScalar(10))),h=new r.qb(new r.Xb(0,0,1),u),f=new r.qb(new r.Xb(1,0,0),c),p=new r.Xb(0,0,0);void 0===h.intersectLine(l,p)&&void 0===f.intersectLine(l,p)||(e[1]=p),h=new r.qb(new r.Xb(0,0,-1),u),f=new r.qb(new r.Xb(-1,0,0),c);var d=new r.Xb(0,0,0);void 0===h.intersectLine(l,d)&&void 0===f.intersectLine(l,d)||(e[0]=d),e[0].y>e[1].y?e[0].y=Object(wt.lerp)(e[0].y,e[1].y,.75):e[1].y=Object(wt.lerp)(e[1].y,e[0].y,.75);for(var b=-this.options.bounds.y/2+1,y=0;y<e.length;y++)e[y].y=Math.max(b,e[y].y);return new r.m([e[0],e[1]])}}])&&se(e.prototype,o),i&&se(e,i),s}(),ye="__private_"+de+++"_"+"bottomPadding";function me(t){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ve(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function we(t,e){return(we=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ge(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Se(t);if(e){var o=Se(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Oe(this,n)}}function Oe(t,e){return!e||"object"!==me(e)&&"function"!=typeof e?xe(t):e}function xe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Se(t){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var je=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&we(t,e)}(s,r["E"]);var e,o,i,a=ge(s);function s(t,e,o){var i;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(i=a.call(this,e)).type="WaterMesh",i.webgl=t,i.options=e,i.waterCurve=o,i.options.water.level<=.001)return Oe(i);var c=n(53);i.rng=c(i.options.seed);var u=Kt[i.options.biome.name].water,l=u.color.clone().add(new r.p(.05*i.rng(),.05*i.rng(),.05*i.rng())),h=new r.eb({color:l,transparent:!0,opacity:u.opacity,roughness:.01,reflectivity:1}),f=i.generateMesh();return i.mesh=new r.cb(f,h),i.mesh.castShadow=!1,i.mesh.receiveShadow=!1,i.add(i.mesh),ie(xe(i),f,h,1,1,-i.options.bounds.y/2),i}return e=s,(o=[{key:"generateMesh",value:function(){var t=new r.rb(this.options.bounds.x,this.options.bounds.z,1,1);t.rotateX(-Math.PI/2);this.waterCurve.getPoints(10);for(var e=this.options.bounds.y/2,n=t.getAttribute("position").array,o=0,i=0,a=n.length/3;o<a;o++,i+=3)n[i]*=.999,n[i+1]=Object(wt.lerp)(-e,e,this.options.water.level),n[i+2]*=.999;return t}}])&&ve(e.prototype,o),i&&ve(e,i),s}();function Pe(t){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ke(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(t,e)||Ee(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Ee(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Ee(t,e){if(t){if("string"==typeof t)return _e(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_e(t,e):void 0}}function _e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function De(t,e){return(De=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Le(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Te(t);if(e){var o=Te(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ze(this,n)}}function ze(t,e){return!e||"object"!==Pe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Te(t){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ae=vt.queue({url:"textures/equirectangular/cloud_layers_1k.hdr"}),Ve=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&De(t,e)}(s,r["E"]);var e,o,i,a=Le(s);function s(t,e){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var i=Date.now();(o=a.call(this,e)).webgl=t,o.options=e,o.type="Diorama",void 0!==o.options.diorama.seed&&null!==o.options.diorama.seed||(o.options.diorama.seed=0),console.log("Creating new diorama (seed=".concat(e.diorama.seed,", bounds=[").concat(e.diorama.bounds.x,", ").concat(e.diorama.bounds.y,", ").concat(e.diorama.bounds.z,"])"));var c=o.options.diorama.bounds.x/2,u=o.options.diorama.bounds.z/2,l=Math.max(c,u),h=new r.e(new r.Wb(-l,-l),new r.Wb(l,l));o.options.diorama.contextQuadtree=new re(t,h),o.setupLights();var f=n(53);if(o.rng=f(o.options.diorama.seed),o.terrain=new be(o.webgl,o.options.diorama),o.add(o.terrain),o.water=null,!0===o.options.diorama.water.enabled&&(o.water=new je(o.webgl,o.options.diorama,o.terrain.waterCurve),o.add(o.water),window.DEBUG)){var p=o.terrain.waterCurve.getPoints(10),d=(new r.j).setFromPoints(p),b=new r.O({color:16711935}),y=new r.M(d,b);o.add(y)}var m,v=Re(Kt[o.options.diorama.biome.name].assets);try{for(v.s();!(m=v.n()).done;){var w=m.value;o.distributeObjects(w)}}catch(t){v.e(t)}finally{v.f()}if(o.createBase(),window.DEBUG){var g=new r.h(o.options.diorama.bounds.x,o.options.diorama.bounds.y,o.options.diorama.bounds.z),O=new r.cc(g);o.wireframe=new r.Q(O),o.wireframe.material.depthTest=!0,o.wireframe.material.opacity=.2,o.wireframe.material.transparent=!0,o.add(o.wireframe)}var x=Date.now()-i;return console.log("Generated in ".concat(x/1e3,"s")),o}return e=s,(o=[{key:"update",value:function(t,e){}},{key:"setupLights",value:function(){this.skylight=new r.G(16777215,16777215,.8),this.skylight.color.setHSL(.56,.7,.6),this.skylight.groundColor.setHSL(.095,.5,.5),this.skylight.position.set(0,50,0),this.add(this.skylight);var t=Math.max(this.options.diorama.bounds.x,this.options.diorama.bounds.y,this.options.diorama.bounds.z)/2;if(this.sun=new r.v(16777215,1),this.sun.color.setHSL(.1,1,.95),this.sun.position.set(-.5,1,.375),this.sun.position.multiplyScalar(t),this.sun.castShadow=!0,this.sun.shadow.mapSize.width=1024,this.sun.shadow.mapSize.height=1024,this.sun.shadow.camera.left=1.5*-t,this.sun.shadow.camera.right=1.5*t,this.sun.shadow.camera.top=1.5*t,this.sun.shadow.camera.bottom=1.5*-t,this.sun.shadow.camera.near=.1,this.sun.shadow.camera.far=3*t,this.add(this.sun),window.DEBUG){var e=new r.k(this.sun.shadow.camera);this.add(e)}var n=new r.ob(this.webgl.renderer);n.compileEquirectangularShader();this.webgl.scene;var o=vt.get(Ae);this.webgl.scene.environment=n.fromEquirectangular(o).texture,o.dispose(),n.dispose(),this.webgl.renderer.toneMapping=r.a,this.webgl.renderer.toneMappingExposure=.25,this.webgl.renderer.outputEncoding=r.dc}},{key:"createBase",value:function(){var t=new r.h(this.options.diorama.bounds.x+4,2,this.options.diorama.bounds.z+4),e=new r.eb({color:new r.p(.2,.2,.2),roughness:.25}),n=new r.cb(t,e);n.translateY(-this.options.diorama.bounds.y/2-1),n.castShadow=!0,n.receiveShadow=!0,this.add(n);var o=2*Math.max(this.options.diorama.bounds.x,this.options.diorama.bounds.z),i=new r.sb(o,o);i.rotateX(-Math.PI/2),i.translate(0,-this.options.diorama.bounds.y/2-2,0);var a=new r.Hb({opacity:.25}),s=new r.cb(i,a);s.receiveShadow=!0,this.add(s)}},{key:"distributeObjects",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===e&&(e=this.terrain.mesh);var o=(new r.f).setFromObject(e),i=t.prototype.constructor.className,a=(o.max.x-o.min.x)*(o.max.z-o.min.z);void 0!==this.options.diorama.biome.assets&&i in this.options.diorama.biome.assets&&(a*=this.options.diorama.biome.assets[i]),hasOwnProperty.call(t,"baseDensity")?a*=t.baseDensity:console.warn("Class '".concat(i,"' had no baseDensity property!")),a=Math.floor(a);for(var s=n(53),c=s(this.options.diorama.seed),u=new r.Db,l={bounds:this.options.diorama.bounds},h=0;h<a;h++){var f=new r.Xb(c(),0,c());f.multiply((new r.Xb).subVectors(o.max,o.min)),f.add(new r.Xb(-.5,1,-.5).multiply(this.options.diorama.bounds)),u.set(f,new r.Xb(0,-1,0));var p=this.options.diorama.contextQuadtree.getLabels(f);if(!1!==this.meetsDistributionRequirements(t,c,p)){var d=u.intersectObjects(this.children,!0),b=16711680;if(d.length>0&&(b=255,l.isUnderwater=!1,!0===t.allowUnderwater&&null!==this.water&&d[0].object===this.water.mesh&&(l.isUnderwater=!0,d[0]=d[1]),d[0].object===e)){b=65280,f=d[0].point,l.seed=this.options.diorama.seed+h,l.labels=this.options.diorama.contextQuadtree.getLabels(f),l.terrainColor=this.options.diorama.contextQuadtree.getAverageColor(f);var y=new t(this.webgl,l);y.position.set(f.x,f.y,f.z),y.updateMatrixWorld(),this.add(y),hasOwnProperty.call(t,"labels")?t.labels.length>0?this.options.diorama.contextQuadtree.addLabels(t.labels,f):console.warn("No labels defined for class ".concat(y.type)):console.warn("Failed to find labels property on class ".concat(y.type))}if(window.DEBUG){var m=new r.c(u.ray.direction,u.ray.origin,1.5*this.options.diorama.bounds.y,b,1,.5);this.add(m)}}}}},{key:"meetsDistributionRequirements",value:function(t,e,n){for(var r=0,o=Object.entries(t.distributionOptions);r<o.length;r++){var i=ke(o[r],2),a=i[0],s=i[1];if(!0===Object.keys(n).includes(a)&&e()<=s)return!0}return!1}}])&&Ce(e.prototype,o),i&&Ce(e,i),s}();var Me=n(108),Ie=n.n(Me);function Xe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(t,e)||Ue(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(t,e){if(t){if("string"==typeof t)return He(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?He(t,e):void 0}}function He(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Be(t){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ne(t,e)}function Ne(t,e){return(Ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ge(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=Fe(t);if(e){var o=Fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qe(this,n)}}function qe(t,e){return!e||"object"!==Be(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Fe(t){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ye(t,e,n){return e&&$e(t.prototype,e),n&&$e(t,n),t}var Je={options:{seed:{max:1e4}},bounds:{x:{min:5,max:60},y:{min:5,max:30},z:{min:5,max:60}},water:{level:{max:1,step:.01},depth:{max:10,step:.5},width:{min:.5,max:20,step:.5},falloff:{min:.5,max:20,step:.5}},shoreline:{width:{max:10,step:.5},falloff:{max:10,step:.5}}},Ze=function(){function t(e,n){var r=this;Qe(this,t),this.owner=e,this.options=n,this.field=document.createElement("div"),this.label=document.createElement("label"),this.label.innerText=an(n.name),this.field.appendChild(this.label),this.input=document.createElement("input"),this.input.onchange=function(){return r.propertyChanged()},this.field.appendChild(this.input),n.parent.appendChild(this.field)}return Ye(t,[{key:"propertyChanged",value:function(){this.owner.propertyChanged()}},{key:"setVisibility",value:function(t){this.field.style.display=t?"block":"none"}}]),t}(),Ke=function(t){We(n,Ze);var e=Ge(n);function n(t,r){var o;return Qe(this,n),(o=e.call(this,t,r)).input.setAttribute("type","checkbox"),o.input.checked=1==r.defaultValue,o}return Ye(n,[{key:"getValue",value:function(){return this.input.checked}}]),n}(),tn=function(t){We(n,Ze);var e=Ge(n);function n(t,r){var o;return Qe(this,n),(o=e.call(this,t,r)).input.setAttribute("type","range"),o.input.setAttribute("min",r.min),o.input.setAttribute("max",r.max),o.input.setAttribute("step",r.step),o.input.value=r.defaultValue,o}return Ye(n,[{key:"getValue",value:function(){return parseFloat(this.input.value)}}]),n}(),en=function(){function t(e,n){var r=this;Qe(this,t),this.owner=e,this.options=n,this.biomeName=n.defaultValue.name,this.div=document.createElement("div"),this.heading=document.createElement("h"+n.depth),this.heading.innerText="Biome",this.div.appendChild(this.heading),this.biomeSelect=document.createElement("select");for(var o=0,i=Object.keys(Kt);o<i.length;o++){var a=i[o],s=document.createElement("option");s.value=a,s.innerText=an(a),a===this.biomeName&&(s.selected=!0),this.biomeSelect.appendChild(s)}this.biomeSelect.onchange=function(){return r.biomeChanged()},this.heading.appendChild(this.biomeSelect),this.controls={},this.updateControls(),n.parent.appendChild(this.div)}return Ye(t,[{key:"biomeChanged",value:function(){this.biomeName=this.biomeSelect.options[this.biomeSelect.selectedIndex].value,this.updateControls(),this.propertyChanged()}},{key:"updateControls",value:function(){for(var t=0,e=Object.keys(this.controls);t<e.length;t++){var n=e[t];this.div.removeChild(this.controls[n].div)}this.controls={};var r={name:"assets",optionsObject:Kt[this.biomeName].assets,valueOverrides:this.options.optionsObject.assets,parent:this.div,depth:this.options.depth+1};this.controls.assets=new nn(this,r)}},{key:"propertyChanged",value:function(){this.options.optionsObject.assets=this.controls.assets.getValue(),this.owner.propertyChanged()}},{key:"getValue",value:function(){for(var t={name:this.biomeName},e=0,n=Object.entries(this.controls);e<n.length;e++){var r=Xe(n[e],2),o=r[0],i=r[1];t[o]=i.getValue()}return t}}]),t}(),nn=function(){function t(e,n){Qe(this,t),this.owner=e,this.options=n,this.div=document.createElement("div"),this.controls={};var r,o={parent:this.div,min:0,max:3,step:.1},i=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Ue(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(n.optionsObject);try{for(i.s();!(r=i.n()).done;){var a=r.value.prototype.constructor.className,s=1;void 0!==this.options.valueOverrides&&Object.keys(this.options.valueOverrides).indexOf(a)>-1&&(s=this.options.valueOverrides[a]),Object.assign(o,{name:a,defaultValue:s}),this.controls[a]=new tn(this,o)}}catch(t){i.e(t)}finally{i.f()}n.parent.appendChild(this.div)}return Ye(t,[{key:"propertyChanged",value:function(){this.owner.propertyChanged()}},{key:"getValue",value:function(){for(var t={},e=0,n=Object.entries(this.controls);e<n.length;e++){var r=Xe(n[e],2),o=r[0],i=r[1];t[o]=i.getValue()}return t}}]),t}(),rn=function(){function t(e,n){Qe(this,t),this.owner=e,this.options=n,this.div=document.createElement("div"),this.heading=document.createElement("h"+n.depth),this.heading.innerText=an(n.name),this.div.appendChild(this.heading),this.controls={};for(var r=0,o=Object.entries(n.optionsObject);r<o.length;r++){var i=Xe(o[r],2),a=i[0],s=i[1],c={name:a,defaultValue:s,parent:this.div};switch(Be(s)){case"boolean":this.controls[a]=new Ke(this,c);break;case"number":Object.assign(c,{min:0,max:100,step:1}),n.name in Je&&a in Je[n.name]&&Object.assign(c,Je[n.name][a]),this.controls[a]=new tn(this,c);break;case"object":!1===Ie()(s)&&(Object.assign(c,{optionsObject:s,depth:n.depth+1}),this.controls[a]="biome"===a?new en(this,c):new t(this,c))}}n.parent.appendChild(this.div)}return Ye(t,[{key:"propertyChanged",value:function(){"enabled"in this.controls&&this.setVisibility(this.controls.enabled.getValue()),this.owner.propertyChanged()}},{key:"getValue",value:function(){for(var t={},e=0,n=Object.entries(this.controls);e<n.length;e++){var r=Xe(n[e],2),o=r[0],i=r[1];t[o]=i.getValue()}return t}},{key:"setVisibility",value:function(t){for(var e=0,n=Object.entries(this.controls);e<n.length;e++){var r=Xe(n[e],2),o=r[0];r[1];"enabled"!==o&&this.controls[o].setVisibility(t)}}}]),t}(),on=function(){function t(e,n){Qe(this,t),this.webgl=e,this.options=n;var r=document.getElementById("controls");this.controls=new rn(this,{name:"options",optionsObject:this.options,depth:1,parent:r})}return Ye(t,[{key:"propertyChanged",value:function(){void 0!==this.webgl.scene.diorama&&(this.webgl.scene.remove(this.webgl.scene.diorama),this.webgl.scene.diorama=void 0);var t=this.controls.getValue();sessionStorage.setItem("dioramaOptions",JSON.stringify(t)),this.webgl.scene.diorama=new Ve(this.webgl,{diorama:t}),this.webgl.scene.add(this.webgl.scene.diorama)}}]),t}();function an(t){return Ie()(t)?t:t[0].toUpperCase()+t.slice(1)}window.DEBUG=window.location.search.includes("debug");var sn=new _({canvas:document.querySelector("#app"),alpha:!0,background:"#ABC",backgroundAlpha:1,showFps:window.DEBUG,orbitControls:!0});window.DEBUG&&(window.webgl=sn);var cn=function(){var t={seed:2655,bounds:new r.Xb(48,16,32),biome:{name:Object.keys(Kt)[0]},water:{enabled:!0,level:.25,depth:1,width:2,falloff:6,shoreline:{enabled:!0,width:1,falloff:2}}},e=sessionStorage.getItem("dioramaOptions");if(null!==e){var n={};try{n=JSON.parse(e)}catch(t){console.log("Error when parsing session options!")}Object.assign(t,n)}return t}();new on(sn,cn),sn.canvas.style.visibility="hidden",vt.load({renderer:sn.renderer}).then(function(){sn.scene.diorama=new Ve(sn,{diorama:cn}),sn.scene.add(sn.scene.diorama),sn.canvas.style.visibility="",sn.orbitControls.target.set(0,-cn.bounds.y/5,0),sn.start(),sn.draw()})}});
//# sourceMappingURL=app.5379e157.js.map