!function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],f=0,p=[];f<s.length;f++)a=s[f],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={0:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([285,1]),n()}({206:function(e,t){},220:function(e,t){},285:function(e,t,n){"use strict";n.r(t);n(104),n(70),n(115),n(116),n(24),n(121),n(91),n(123),n(15),n(73),n(180),n(181),n(129),n(130),n(131),n(18),n(22),n(95),n(25),n(133),n(185);var r=n(0),o=n(157),i=n(158),a=n.n(i),s=n(159),c=n.n(s),u=n(160),l=n.n(u),f=n(161),p=n.n(f),h=n(162),d=n.n(h),b=n(163),y=n(170),m=n(164),v=n(6),w=n.n(v);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tmpVec0=new w.a.Vec3,this.tmpVec1=new w.a.Vec3,this.tmpVec2=new w.a.Vec3,this.tmpQuat0=new w.a.Vec3,this.scene=t,this.world=n,this._meshes=[],this._material=new r.cb({color:65280,wireframe:!0}),this._sphereGeometry=new r.Kb(1),this._boxGeometry=new r.h(1,1,1),this._planeGeometry=new r.rb(10,10,10,10),this._cylinderGeometry=new r.s(1,1,10,10)}var t,n,o;return t=e,(n=[{key:"update",value:function(){for(var e=this.world.bodies,t=this._meshes,n=this.tmpVec0,r=this.tmpQuat0,o=0,i=0;i!==e.length;i++)for(var a=e[i],s=0;s!==a.shapes.length;s++){var c=a.shapes[s];this._updateMesh(o,a,c);var u=t[o];u&&(a.quaternion.vmult(a.shapeOffsets[s],n),a.position.vadd(n,n),a.quaternion.mult(a.shapeOrientations[s],r),u.position.copy(n),u.quaternion.copy(r),"visible"in a&&(u.visible=a.visible)),o+=1}for(var l=o;l<t.length;l++){var f=t[l];f&&this.scene.remove(f)}t.length=o}},{key:"_updateMesh",value:function(e,t,n){var r=this._meshes[e];this._typeMatch(r,n)||(r&&this.scene.remove(r),r=this._meshes[e]=this._createMesh(n)),this._scaleMesh(r,n)}},{key:"_createMesh",value:function(e){var t,n=this._material,o=new r.C;switch(e.type){case w.a.Shape.types.SPHERE:t=new r.bb(this._sphereGeometry,n);break;case w.a.Shape.types.BOX:t=new r.bb(this._boxGeometry,n);break;case w.a.Shape.types.PLANE:t=new r.bb(this._planeGeometry,n);break;case w.a.Shape.types.CONVEXPOLYHEDRON:for(var i=0;i<e.vertices.length;i++){var a=e.vertices[i];o.vertices.push(new r.Wb(a.x,a.y,a.z))}for(var s=0;s<e.faces.length;s++)for(var c=e.faces[s],u=c[0],l=1;l<c.length-1;l++){var f=c[l],p=c[l+1];o.faces.push(new r.y(u,f,p))}o.computeBoundingSphere(),o.computeFaceNormals(),t=new r.bb(o,n),e.geometryId=o.id;break;case w.a.Shape.types.TRIMESH:for(var h=0;h<e.indices.length/3;h++){e.getTriangleVertices(h,this.tmpVec0,this.tmpVec1,this.tmpVec2),o.vertices.push(new r.Wb(this.tmpVec0.x,this.tmpVec0.y,this.tmpVec0.z),new r.Wb(this.tmpVec1.x,this.tmpVec1.y,this.tmpVec1.z),new r.Wb(this.tmpVec2.x,this.tmpVec2.y,this.tmpVec2.z));var d=o.vertices.length-3;o.faces.push(new r.y(d,d+1,d+2))}o.computeBoundingSphere(),o.computeFaceNormals(),t=new r.bb(o,n),e.geometryId=o.id;break;case w.a.Shape.types.HEIGHTFIELD:for(var b=0;b<e.data.length-1;b++)for(var y=0;y<e.data[b].length-1;y++)for(var m=0;m<2;m++){e.getConvexTrianglePillar(b,y,0===m),this.tmpVec0.copy(e.pillarConvex.vertices[0]),this.tmpVec1.copy(e.pillarConvex.vertices[1]),this.tmpVec2.copy(e.pillarConvex.vertices[2]),this.tmpVec0.vadd(e.pillarOffset,this.tmpVec0),this.tmpVec1.vadd(e.pillarOffset,this.tmpVec1),this.tmpVec2.vadd(e.pillarOffset,this.tmpVec2),o.vertices.push(new r.Wb(this.tmpVec0.x,this.tmpVec0.y,this.tmpVec0.z),new r.Wb(this.tmpVec1.x,this.tmpVec1.y,this.tmpVec1.z),new r.Wb(this.tmpVec2.x,this.tmpVec2.y,this.tmpVec2.z));var v=o.vertices.length-3;o.faces.push(new r.y(v,v+1,v+2))}o.computeBoundingSphere(),o.computeFaceNormals(),t=new r.bb(o,n),e.geometryId=o.id}return t&&this.scene.add(t),t}},{key:"_typeMatch",value:function(e,t){if(!e)return!1;var n=e.geometry;return n instanceof r.Kb&&t instanceof w.a.Sphere||n instanceof r.h&&t instanceof w.a.Box||n instanceof r.rb&&t instanceof w.a.Plane||n.id===t.geometryId&&t instanceof w.a.ConvexPolyhedron||n.id===t.geometryId&&t instanceof w.a.Trimesh||n.id===t.geometryId&&t instanceof w.a.Heightfield}},{key:"_scaleMesh",value:function(e,t){var n=t.radius;switch(t.type){case w.a.Shape.types.SPHERE:e.scale.set(n,n,n);break;case w.a.Shape.types.BOX:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2);break;case w.a.Shape.types.CONVEXPOLYHEDRON:e.scale.set(1,1,1);break;case w.a.Shape.types.TRIMESH:e.scale.copy(t.scale);break;case w.a.Shape.types.HEIGHTFIELD:e.scale.set(1,1,1)}}}])&&g(t.prototype,n),o&&g(t,o),e}();function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var _=0;function E(e){return"__private_"+_+++"_"+e}var R=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.background,s=void 0===i?"#000":i,c=n.backgroundAlpha,u=void 0===c?1:c,f=n.fov,h=void 0===f?45:f,v=n.near,w=void 0===v?.1:v,g=n.far,P=void 0===g?500:g,_=S(n,["background","backgroundAlpha","fov","near","far"]);if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,D,{writable:!0,value:[]}),Object.defineProperty(this,C,{writable:!0,value:new r.Wb}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,V,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),this.resize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=void 0===n?t.width:n,o=e.height,i=void 0===o?t.height:o,a=e.pixelRatio,s=void 0===a?t.pixelRatio:a;return t.renderer.getPixelRatio()!==s&&t.renderer.setPixelRatio(s),t.renderer.setSize(r,i),t.camera.isPerspectiveCamera&&(t.camera.aspect=r/i),t.camera.updateProjectionMatrix(),t.composer&&t.composer.setSize(s*r,s*i),t.scene.traverse(function(e){"function"==typeof e.resize&&e.resize({width:r,height:i,pixelRatio:s})}),t.draw(),t},this.saveScreenshot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=void 0===n?2560:n,o=e.height,i=void 0===o?1440:o,a=e.fileName,s=void 0===a?"image.png":a;t.resize({width:r,height:i,pixelRatio:1}),t.draw();var c=t.canvas.toDataURL("image/png");t.resize(),t.draw(),z(s,c)},this.update=function(e,n,r){return t.orbitControls&&t.orbitControls.update(),t.scene.traverse(function(t){"function"==typeof t.update&&t.update(e,n,r)}),t.world&&(t.world.step(1/60,e),t.cannonDebugRenderer&&t.cannonDebugRenderer.update(),t.world.bodies.forEach(function(t){"function"==typeof t.update&&t.update(e,n)})),k(t,D)[D].forEach(function(t){return t(e,n,r)}),t},this.draw=function(){return t.composer?(t.composer.passes.forEach(function(e,t,n){var r=t===n.length-1;e.renderToScreen=!!r}),t.composer.render()):t.renderer.render(t.scene,t.camera),t},this.start=function(){if(!t.isRunning)return t.renderer.setAnimationLoop(t.animate),t.isRunning=!0,t},this.stop=function(){if(t.isRunning)return t.renderer.setAnimationLoop(null),t.isRunning=!1,t},this.animate=function(e,n){if(t.isRunning){t.stats&&t.stats.begin();var r=Math.min(t.maxDeltaTime,(e-k(t,L)[L])/1e3);t.time+=r,k(t,L)[L]=e,t.update(r,t.time,n),t.draw(),t.stats&&t.stats.end()}},this.traverse=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];t.scene.traverse(function(t){"function"==typeof t[e]&&t[e].apply(t,r)})},this.renderer=new r.ac(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){j(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({antialias:!0,alpha:!1,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},_)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=r.mb,this.renderer.sortObjects=!1,this.canvas=this.renderer.domElement,this.renderer.setClearColor(s,u),_.xr&&(this.renderer.xr.enabled=!0),k(this,V)[V]=_.width,k(this,T)[T]=_.height,this.maxPixelRatio=_.maxPixelRatio||2,this.maxDeltaTime=_.maxDeltaTime||1/30,this.camera=new r.ob(h,1,w,P),this.scene=new r.Eb,this.gl=this.renderer.getContext(),this.time=0,this.isRunning=!1,k(this,L)[L]=performance.now(),window.addEventListener("resize",this.resize),window.addEventListener("orientationchange",this.resize),this.resize(),this.touchHandler=a()(this.canvas,{target:this.canvas,filtered:!0}),this.isDragging=!1,this.touchHandler.on("start",function(e,n){t.isDragging=!0,t.traverse("onPointerDown",e,n)}),this.touchHandler.on("move",function(e,n){return t.traverse("onPointerMove",e,n)}),this.touchHandler.on("end",function(e,n){t.isDragging=!1,t.traverse("onPointerUp",e,n)}),_.postprocessing&&(this.composer=new y.a(this.renderer),this.composer.addPass(new m.a(this.scene,this.camera))),_.orbitControls&&(this.camera.position.set(40,20,-50),this.orbitControls=new o.a(this.camera,this.renderer.domElement),this.orbitControls.update()),_.world&&(this.world=_.world,_.showWorldWireframes&&(this.cannonDebugRenderer=new O(this.scene,this.world))),_.showFps&&(this.stats=new l.a,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)),_.controls){var E=p()(_.controls);if(this.controls=_.hideControls?E:d()(E,{expanded:!_.closeControls}),!_.hideControls){var R=document.createElement("style");R.type="text/css",R.innerHTML='\n          [class^="controlPanel-"] [class*="__field"]::before {\n            content: initial !important;\n          }\n          [class^="controlPanel-"] [class*="__labelText"] {\n            text-indent: 6px !important;\n          }\n          [class^="controlPanel-"] [class*="__field--button"] > button::before {\n            content: initial !important;\n          }\n        ',document.head.appendChild(R)}}var M=Object(b.getGPUTier)({glContext:this.renderer.getContext()});this.gpu={name:M.type,tier:Number(M.tier.slice(-1)),isMobile:M.tier.toLowerCase().includes("mobile")}}var t,n,i;return t=e,(n=[{key:"onUpdate",value:function(e){k(this,D)[D].push(e)}},{key:"offUpdate",value:function(e){var t=k(this,D)[D].indexOf(e);-1!==t&&k(this,D)[D].splice(t,1)}},{key:"width",get:function(){return k(this,V)[V]||window.innerWidth}},{key:"height",get:function(){return k(this,T)[T]||window.innerHeight}},{key:"pixelRatio",get:function(){return Math.min(this.maxPixelRatio,window.devicePixelRatio)}},{key:"cursor",get:function(){return this.canvas.style.cursor},set:function(e){this.canvas.style.cursor=e||null}}])&&P(t.prototype,n),i&&P(t,i),e}(),D=E("updateListeners"),C=E("tmpTarget"),L=E("lastTime"),V=E("width"),T=E("height");function z(e,t){var n=c()(t),r=document.createElement("a");r.download=e,r.href=window.URL.createObjectURL(n),r.onclick=setTimeout(function(){window.URL.revokeObjectURL(n),r.removeAttribute("href")},0),r.click()}n(29),n(30),n(74),n(195),n(98),n(196),n(51),n(100),n(31),n(101);var M=n(165),A=n.n(M),W=n(77),I=n.n(W),B=n(76),H=n(166);n(208);function U(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function G(e,t){return F.apply(this,arguments)}function F(){var e;return e=regeneratorRuntime.mark(function e(t,n){var o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new r.Pb).name=t,o.encoding=n.encoding||r.Q,q(t,o,n),e.prev=4,e.next=7,Object(B.a)(t,{crossorigin:"anonymous"});case 7:return i=e.sent,o.image=i,o.needsUpdate=!0,n.renderer&&n.renderer.initTexture(o),e.abrupt("return",o);case 14:throw e.prev=14,e.t0=e.catch(4),new Error("Could not load texture ".concat(t));case 17:case"end":return e.stop()}},e,null,[[4,14]])}),(F=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){U(i,r,o,a,s,"next",e)}function s(e){U(i,r,o,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}function q(e,t,n){if("boolean"==typeof n.flipY&&(t.flipY=n.flipY),void 0!==n.mapping&&(t.mapping=n.mapping),void 0!==n.format)t.format=n.format;else{var o=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data:image\/jpeg/);t.format=o?r.Bb:r.yb}n.repeat&&t.repeat.copy(n.repeat),t.wrapS=n.wrapS||r.n,t.wrapT=n.wrapT||r.n,t.minFilter=n.minFilter||r.S,t.magFilter=n.magFilter||r.R,t.generateMipmaps=!1!==n.generateMipmaps}n(210);var N=n(167),Q=n.n(N),$=n(171);function Y(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function X(){var e;return e=regeneratorRuntime.mark(function e(t,n){var o,i,a,s,c,u,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.renderer){e.next=3;break}throw new Error("Env map requires renderer to passed in the options for ".concat(t,"!"));case 3:if(!n.equirectangular){e.next=17;break}return e.next=6,G(t,{renderer:o});case 6:if(i=e.sent,!n.pmrem){e.next=11;break}return e.abrupt("return",K(i,o));case 11:return a=Q()(i.image.naturalHeight),s=new r.Yb(a,{generateMipmaps:!0,minFilter:r.T,magFilter:r.R}),c=s.fromEquirectangularTexture(o,i),i.dispose(),i.image.data=null,e.abrupt("return",c);case 17:if(u=t,l=n.extension||".jpg",p="".concat(u.replace(/\/$/,""),"/"),h=l,f=["".concat(p,"px").concat(h),"".concat(p,"nx").concat(h),"".concat(p,"py").concat(h),"".concat(p,"ny").concat(h),"".concat(p,"pz").concat(h),"".concat(p,"nz").concat(h)],".hdr"!==l){e.next=22;break}return e.abrupt("return",new Promise(function(e,t){(new $.a).load(r.Ub,f,function(t){return e(J(t,n))},null,function(){return t(new Error("Could not load env map: ".concat(u)))})}));case 22:return e.abrupt("return",new Promise(function(e,t){(new r.r).load(f,function(t){return e(J(t,n))},null,function(){return t(new Error("Could not load env map: ".concat(u)))})}));case 23:case"end":return e.stop()}var p,h},e)}),(X=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Y(i,r,o,a,s,"next",e)}function s(e){Y(i,r,o,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}function J(e,t){return t.encoding&&(e.encoding=t.encoding),t.format&&(e.format=t.format),t.pmrem&&(e=function(e,t){var n=new r.nb(t);n.compileCubemapShader();var o=n.fromCubemap(e);return n.dispose(),e.dispose(),e.image.data=null,o.texture}(e,t.renderer)),e}function K(e,t){var n=new r.nb(t);n.compileEquirectangularShader();var o=n.fromEquirectangular(e);return n.dispose(),e.dispose(),e.image.data=null,o.texture}function Z(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function te(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function ne(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){te(i,r,o,a,s,"next",e)}function s(e){te(i,r,o,a,s,"throw",e)}a(void 0)})}}function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach(function(t){ie(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ce(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var ue=0;function le(e){return"__private_"+ue+++"_"+e}var fe=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,pe,{writable:!0,value:[]}),Object.defineProperty(this,he,{writable:!0,value:{}}),Object.defineProperty(this,de,{writable:!0,value:[]}),Object.defineProperty(this,be,{writable:!0,value:10}),Object.defineProperty(this,ye,{writable:!0,value:[]}),this.get=function(e){if(!e)throw new TypeError("Must specify an URL for AssetManager.get()");return ce(t,he)[he][e]}}var t,n,r,o,i;return t=e,(n=[{key:"addProgressListener",value:function(e){if("function"!=typeof e)throw new TypeError("onProgress must be a function");ce(this,de)[de].push(e)}},{key:"queue",value:function(e){var t=e.url,n=e.type,r=ae(e,["url","type"]);if(!t)throw new TypeError("Must specify a URL or opt.url for AssetManager.queue()");return this._getQueued(t)||ce(this,pe)[pe].push(oe({url:t,type:n||this._extractType(t)},r)),t}},{key:"_getQueued",value:function(e){return ce(this,pe)[pe].find(function(t){return t.url===e})}},{key:"_extractType",value:function(e){var t=e.slice(e.lastIndexOf("."));switch(!0){case/\.(gltf|glb)$/i.test(t):return"gltf";case/\.json$/i.test(t):return"json";case/\.svg$/i.test(t):return"svg";case/\.(jpe?g|png|gif|bmp|tga|tif)$/i.test(t):return"image";case/\.(wav|mp3)$/i.test(t):return"audio";case/\.(mp4|webm|ogg|ogv)$/i.test(t):return"video";default:throw new Error("Could not load ".concat(e,", unknown file extension!"))}}},{key:"loadSingle",value:(i=ne(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.renderer,r=ae(t,["renderer"]),n){e.next=3;break}throw new Error("You must provide a renderer to the loadSingle function.");case 3:return e.prev=3,o=Date.now(),e.next=7,this._loadItem(oe({renderer:n},r));case 7:return ce(this,he)[he][r.url]=e.sent,window.DEBUG&&console.log("\ud83d\udce6 Loaded single asset %c".concat(r.url,"%c in ").concat(I()(Date.now()-o)),"color:blue","color:black"),e.abrupt("return",r.url);case 12:e.prev=12,e.t0=e.catch(3),delete ce(this,he)[he][r.url],console.error("\ud83d\udce6 Asset ".concat(r.url," was not loaded:\n").concat(e.t0));case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return i.apply(this,arguments)})},{key:"load",value:(o=ne(regeneratorRuntime.mark(function e(t){var n,r,o,i,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.renderer){e.next=3;break}throw new Error("You must provide a renderer to the load function.");case 3:if(r=ce(this,pe)[pe].slice(),ce(this,pe)[pe].length=0,0!==(o=r.length)){e.next=9;break}return setTimeout(function(){return ce(s,de)[de].forEach(function(e){return e(1)})},0),e.abrupt("return");case 9:return i=Date.now(),e.next=12,A()(r,function(){var e=ne(regeneratorRuntime.mark(function e(t,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=Date.now(),e.next=4,s._loadItem(oe({renderer:n},t));case 4:ce(s,he)[he][t.url]=e.sent,window.DEBUG&&s.log("Loaded %c".concat(t.url,"%c in ").concat(I()(Date.now()-i)),"color:blue","color:black"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),s.logError("Asset ".concat(t.url," was not loaded:\n").concat(e.t0));case 11:a=(r+1)/o,ce(s,de)[de].forEach(function(e){return e(a)});case 13:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,n){return e.apply(this,arguments)}}(),{concurrency:ce(this,be)[be]});case 12:window.DEBUG&&(0===(a=ce(this,ye)[ye].filter(function(e){return"error"===e.type})).length?this.groupLog("\ud83d\udce6 Assets loaded in ".concat(I()(Date.now()-i)," \u23f1")):this.groupLog("\ud83d\udce6 %c Could not load ".concat(a.length," asset").concat(a.length>1?"s":""," "),"color:white;background:red;"));case 13:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_loadItem",value:function(e){var t=e.url,n=e.type,r=e.renderer,o=ae(e,["url","type","renderer"]);if(t in ce(this,he)[he])return ce(this,he)[he][t];switch(n){case"gltf":return new Promise(function(e,n){(new H.a).load(t,e,null,function(e){return n(new Error("Could not load GLTF asset ".concat(t,":\n").concat(e)))})});case"json":return fetch(t).then(function(e){return e.json()});case"env-map":return function(e,t){return X.apply(this,arguments)}(t,oe({renderer:r},o));case"svg":case"image":return Object(B.a)(t,{crossorigin:"anonymous"});case"texture":return G(t,oe({renderer:r},o));case"audio":return fetch(t).then(function(e){return e.arrayBuffer()});case"video":return fetch(t).then(function(e){return e.blob()});default:throw new Error("Could not load ".concat(t,", the type ").concat(n," is unknown!"))}}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];ce(this,ye)[ye].push({type:"log",text:t})}},{key:"logError",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];ce(this,ye)[ye].push({type:"error",text:t})}},{key:"groupLog",value:function(){var e;(e=console).groupCollapsed.apply(e,arguments),ce(this,ye)[ye].forEach(function(e){var t;(t=console)[e.type].apply(t,Z(e.text))}),console.groupEnd(),ce(this,ye)[ye].length=0}}])&&se(t.prototype,n),r&&se(t,r),e}(),pe=le("queue"),he=le("cache"),de=le("onProgressListeners"),be=le("asyncConcurrency"),ye=le("logs"),me=new fe;n(143),n(53),n(43),n(44);function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=xe(e);if(t){var o=xe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Oe(this,n)}}function Oe(e,t){return!t||"object"!==ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(o,r["D"]);var t=ge(o);function o(e,i){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=t.call(this,i)).type="Building",a.webgl=e,a.options=i;var s=n(35)(a.options.seed),c=new r.h(.25*a.options.bounds.x,.25*a.options.bounds.y,.25*a.options.bounds.z);c.translate(0,.25*a.options.bounds.y*.5,0);var u=.1*s(),l=.1*s(),f=.1*s(),p=new r.p(.5+u,.4+l,.3+f),h=new r.eb({color:p});return a.box=new r.bb(c,h),a.box.name="Building",a.box.castShadow=!0,a.box.receiveShadow=!0,a.add(a.box),a}return o}();je.requiredLabels=["grass"],je.labels=["building"],je.baseDensity=.01;n(221),n(223),n(226),n(231),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255);var Se=n(168);function Pe(e,t,n,o,i,a){var s=t.getAttribute("position").array;t.computeBoundingBox();var c=new r.Wb(0,0,0);t.boundingBox.getSize(c);for(var u=0,l=0;l<4;l++){var f=l%2==1,p=new r.qb(f?c.x:c.z,f?c.z:c.x,f?o:i,1);f?p.translate(0,0,c.z/2):(p.rotateY(-Math.PI/2),p.translate(-c.x/2,0,0));for(var h=p.getAttribute("position").array,d=f?o:i,b=0,y=h.length/3/2;b<y;b++)u=f?l<2?s[3*(b+(o+1)*i)+1]:s[3*b+1]:l<2?s[b*(o+1)*3+1]:s[3*(b*(o+1)+o)+1],h[3*b+1]=u,h[3*(b+d+1)+1]=a;var m=new r.bb(p,n);l>1&&(f?m.scale.z=-1:m.scale.x=-1),m.castShadow=!0,m.receiveShadow=!0,e.add(m)}}var ke=n(45);function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Ve(e);if(t){var o=Ve(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ce(this,n)}}function Ce(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?Le(e):t}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Te(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var ze=0;var Me=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(s,r["D"]);var t,o,i,a=De(s);function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),n=a.call(this,t),Object.defineProperty(Le(n),Ae,{writable:!0,value:2}),n.type="Terrain",n.webgl=e,n.options=t,n.generateHeight(n.options.bounds.x,n.options.bounds.z);var o=new r.qb(n.options.bounds.x,n.options.bounds.z,n.options.bounds.x-1,n.options.bounds.z-1);o.rotateX(-Math.PI/2);for(var i=o.getAttribute("position").array,c=0,u=i.length/3;c<u;c++)i[3*c+1]=n.heightData[c];!0===n.options.water.enabled&&(n.waterCurve=n.getWaterCurve(o),n.modifyGeometryForWater(o)),o.computeVertexNormals();var l=new r.l(n.generateTexture(o,n.options.bounds.x,n.options.bounds.z));l.wrapS=r.n,l.wrapT=r.n;var f=new r.eb({map:l,envMap:n.webgl.scene.environment});n.mesh=new r.bb(o,f),n.mesh.castShadow=!0,n.mesh.receiveShadow=!0,n.add(n.mesh);var p=new r.eb({color:5589288});return Pe(Le(n),o,p,n.options.bounds.x-1,n.options.bounds.z-1,-n.options.bounds.y/2),n}return t=s,(o=[{key:"generateHeight",value:function(e,t){var r=e*t,o=new Se.a,i=1,a=n(35)(this.options.seed)();this.heightData=new Float32Array(r);for(var s=0;s<4;s++){for(var c=0;c<r;c++){var u=c%e,l=~~(c/e);this.heightData[c]+=Math.abs(o.noise(u/i,l/i,a)*i*1.75)}i*=5}for(var f=1e4,p=-1e4,h=0;h<r;h++)this.heightData[h]<f&&(f=this.heightData[h]),this.heightData[h]>p&&(p=this.heightData[h]);for(var d=(this.options.bounds.y-Te(this,Ae)[Ae]-2)/this.options.bounds.y,b=this.options.bounds.y/p,y=0;y<r;y++)this.heightData[y]=((this.heightData[y]-f)*b-.5*this.options.bounds.y+Te(this,Ae)[Ae])*d}},{key:"generateTexture",value:function(e,t,o){var i,a,s,c;(i=document.createElement("canvas")).width=t,i.height=o,(a=i.getContext("2d")).fillStyle="#000",a.fillRect(0,0,t,o),c=(s=a.getImageData(0,0,i.width,i.height)).data;for(var u=n(35)(this.options.seed),l=this.options.bounds.y/2,f=Object(ke.lerp)(-l,l,this.options.water.level),p=e.getAttribute("position").array,h=new r.p(.22+.1*u(),.48+.1*u(),.22+.1*u()),d=new r.p(.63+.05*u(),.52+.05*u(),.33+.05*u()),b=new r.p(.1,.2,.2),y=0,m=p.length/3;y<m;y++){var v=h.clone(),w=["grass"];if(this.options.water.enabled){var g=p[3*y+1];if(g<f&&(v=b.clone(),w=["water"]),!0===this.options.water.sand.enabled){var O=this.options.water.sand.width+this.options.water.sand.falloff;if(g<=f-this.options.water.sand.width){var x=Math.clamp(g/(f-g),0,1);v.lerp(d,x)}else if(O>.001)if(g<=f+this.options.water.sand.width)v=d.clone(),w=["sand"];else if(this.options.water.sand.falloff>.001){var j=Math.clamp((g-f-this.options.water.sand.width)/this.options.water.sand.falloff,0,1);v=d.clone().lerp(h,j),j<=.33?w=["sand"]:j<=.67&&w.push("sand")}}}c[4*y]=255*v.r*(1-.1*u()),c[4*y+1]=255*v.g*(1-.1*u()),c[4*y+2]=255*v.b*(1-.1*u());var S=new r.Vb(p[3*y],p[3*y+2]);this.options.contextQuadtree.addLabels(w,S)}return a.putImageData(s,0,0),i}},{key:"modifyGeometryForWater",value:function(e){for(var t=this.waterCurve.getPoints(10),n=e.getAttribute("position").array,o=new r.Wb(0,0,0),i=new r.Wb(0,0,0),a=0,s=n.length/3;a<s;a++){for(var c=new r.Wb(n[3*a],n[3*a+1],n[3*a+2]),u=new r.Vb(c.x,c.z),l=1e5,f=0;f<t.length-1;f++){new r.M(t[f],t[f+1]).closestPointToPoint(c,!0,o);var p=u.distanceTo(new r.Vb(o.x,o.z));p<l&&(l=p,i=o.clone())}var h=u.distanceTo(new r.Vb(i.x,i.z));h<this.options.water.width/2+this.options.water.falloff&&(n[3*a+1]=this.getWaterVertexHeight(h,i.y,n[3*a+1]))}}},{key:"getWaterVertexHeight",value:function(e,t,n){var r=Math.clamp((e-this.options.water.width/2)/this.options.water.falloff,0,1),o=Object(ke.lerp)(t-this.options.water.depth,n,r),i=-this.options.bounds.y/2+1;return Math.max(i,o)}},{key:"getRandomPointOnTerrain",value:function(){var e=new r.Cb,t=new r.Wb(this.rng(),0,this.rng());t.multiply(this.options.bounds),t.y=this.options.bounds.y,t.sub(new r.Wb(.5,.5,.5).multiply(this.options.bounds)),e.set(t,new r.Wb(0,-1,0));var n=e.intersectObject(this.mesh);return n.length>0?{hit:!0,position:n[0].point}:{hit:!1,position:null}}},{key:"getWaterCurve",value:function(e){for(var t=[new r.Wb(0,1e5,0),new r.Wb(0,1e5,0)],n=new r.Wb,o=e.getAttribute("position").array,i=Math.min(this.options.bounds.x,this.options.bounds.z)/4,a=0;a<o.length/3;a++)for(var s=0;s<t.length;s++)if(n.x=o[3*a],n.y=o[3*a+1],n.z=o[3*a+2],n.y<t[s].y&&(0==s||n.distanceTo(t[s-1])>i)){t[s].x=n.x,t[s].y=n.y,t[s].z=n.z;break}var c=this.options.bounds.x/2,u=this.options.bounds.z/2,l=new r.M(t[0].clone().add(t[1].clone().sub(t[0]).multiplyScalar(-10)),t[0].clone().add(t[1].clone().sub(t[0]).multiplyScalar(10))),f=new r.pb(new r.Wb(0,0,1),u),p=new r.pb(new r.Wb(1,0,0),c),h=new r.Wb(0,0,0);void 0===f.intersectLine(l,h)&&void 0===p.intersectLine(l,h)||(t[1]=h),f=new r.pb(new r.Wb(0,0,-1),u),p=new r.pb(new r.Wb(-1,0,0),c);var d=new r.Wb(0,0,0);void 0===f.intersectLine(l,d)&&void 0===p.intersectLine(l,d)||(t[0]=d),t[0].y>t[1].y?t[0].y=Object(ke.lerp)(t[0].y,t[1].y,.75):t[1].y=Object(ke.lerp)(t[1].y,t[0].y,.75);for(var b=-this.options.bounds.y/2+1,y=0;y<t.length;y++)t[y].y=Math.max(b,t[y].y);return new r.m([t[0],t[1]])}}])&&Ee(t.prototype,o),i&&Ee(t,i),s}(),Ae="__private_"+ze+++"_"+"bottomPadding";function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Ue(e);if(t){var o=Ue(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return He(this,n)}}function He(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(o,r["bb"]);var t=Be(o);function o(e,i){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=t.call(this,i)).type="TreeMesh",a.webgl=e,a.options=i;var s=n(35)(a.options.seed);a.height=a.options.height+(s()-.5)*a.options.height*.5,a.geometry=new r.s(.01,.25*a.height,a.height,32,4,!1),a.geometry.translate(0,.5*a.height,0);var c=.1*s(),u=.1*s(),l=.1*s(),f=new r.p(.1+c,.4+u,.2+l);return a.material=new r.eb({color:f}),a.castShadow=!0,a.receiveShadow=!0,a}return o}();function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ne(e,t){return(Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Xe(e);if(t){var o=Xe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $e(this,n)}}function $e(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?Ye(e):t}function Ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Ge.requiredLabels=["grass"],Ge.labels=["vegetation","tree"],Ge.baseDensity=.1;var Je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ne(e,t)}(s,r["D"]);var t,o,i,a=Qe(s);function s(e,t,o){var i;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=a.call(this,t)).type="WaterMesh",i.webgl=e,i.options=t,i.waterCurve=o,i.options.water.level<=.001)return $e(i);var c=n(35);i.rng=c(i.options.seed);var u=.1*i.rng(),l=.1*i.rng(),f=.1*i.rng(),p=new r.p(.1+u,.15+l,.2+f),h=new r.db({color:p,transparent:!0,opacity:.8,roughness:.1,reflectivity:1,envMap:i.webgl.scene.environment}),d=i.generateMesh();return i.mesh=new r.bb(d,h),i.mesh.castShadow=!1,i.mesh.receiveShadow=!1,i.add(i.mesh),Pe(Ye(i),d,h,1,1,-i.options.bounds.y/2),i}return t=s,(o=[{key:"generateMesh",value:function(){var e=new r.qb(this.options.bounds.x,this.options.bounds.z,1,1);e.rotateX(-Math.PI/2);this.waterCurve.getPoints(10);for(var t=this.options.bounds.y/2,n=e.getAttribute("position").array,o=0,i=0,a=n.length/3;o<a;o++,i+=3)n[i]*=.999,n[i+1]=Object(ke.lerp)(-t,t,this.options.water.level),n[i+2]*=.999;return e}}])&&qe(t.prototype,o),i&&qe(t,i),s}(),Ke=n(169);function Ze(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return et(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var nt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bounds=t,this.labels={},this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}var t,n,o;return t=e,(n=[{key:"addLabels",value:function(t,n){if(!1!==this.bounds.containsPoint(n)){var o,i=Ze(t);try{for(i.s();!(o=i.n()).done;){var a=o.value;a in this.labels?this.labels[a]+=1:this.labels[a]=1}}catch(e){i.e(e)}finally{i.f()}var s=new r.Vb(1,1);if(this.bounds.getSize(s),!(s.x<=1&&s.y<=1)){var c=(this.bounds.min.x+this.bounds.max.x)/2,u=(this.bounds.min.y+this.bounds.max.y)/2;c>=n.x?u>=n.y?(null===this.topLeft&&(this.topLeft=new e(new r.e(this.bounds.min,this.bounds.min.clone().add(this.bounds.max).multiplyScalar(.5)))),this.topLeft.addLabels(t,n)):(null===this.bottomLeft&&(this.bottomLeft=new e(new r.e(new r.Vb(this.bounds.min.x,(this.bounds.min.y+this.bounds.max.y)/2),new r.Vb((this.bounds.min.x+this.bounds.max.x)/2,this.bounds.max.y)))),this.bottomLeft.addLabels(t,n)):u>=n.y?(null===this.topRight&&(this.topRight=new e(new r.e(new r.Vb((this.bounds.min.x+this.bounds.max.x)/2,this.bounds.min.y),new r.Vb(this.bounds.max.x,(this.bounds.min.y+this.bounds.max.y)/2)))),this.topRight.addLabels(t,n)):(null===this.bottomRight&&(this.bottomRight=new e(new r.e(this.bounds.min.clone().add(this.bounds.max).multiplyScalar(.5),this.bounds.max))),this.bottomRight.addLabels(t,n))}}else console.warn("Bounds did not contain position [".concat(n.x,", ").concat(n.y,"]!"))}},{key:"findQuadWithMinLabelDensity",value:function(e,t){var n=this.getLabelDensity(e);if(n<=0)return null;if(n>=t)return this;if(e in this.labels){var r=null,o=0,i=0;return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft].forEach(function(t){null!==t&&(i=t.getLabelDensity(e))>o&&(r=t,o=i)}),r.findQuadWithMinLabelDensity(e,t)}return null}},{key:"findQuadWithMaxLabelDensity",value:function(e,t){var n=this.getLabelDensity(e);if(n<=t)return console.log("Found quad with density ".concat(n," for ").concat(e)),this;if(console.log("This one had ".concat(n," for ").concat(e,", looking in children")),e in this.labels){var r=null,o=t,i=0;return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft].forEach(function(t){null!==t&&(i=t.getLabelDensity(e))<o&&(r=t,o=i)}),r.findQuadWithMaxLabelDensity(e,t)}return null}},{key:"getLabelDensity",value:function(e){if(e in this.labels==!0){var t=new r.Vb(1,1);return this.bounds.getSize(t),this.labels[e]/(t.x*t.y)}return 0}},{key:"hasLabels",value:function(e){var t,n=Ze(e);try{for(n.s();!(t=n.n()).done;){if(t.value in this.labels==!1)return!1}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"positionHasLabels",value:function(e,t){var n=e;if("Vector3"===e.constructor.name&&(n=new r.Vb(e.x,e.z)),!1===this.bounds.containsPoint(n)||!1===this.hasLabels(t))return!1;for(var o=0,i=[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft];o<i.length;o++){var a=i[o];if(null!==a&&a.bounds.containsPoint(n))return a.positionHasLabels(n,t)}return!0}}])&&tt(t.prototype,n),o&&tt(t,o),e}();function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function it(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=st(e);if(t){var o=st(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return at(this,n)}}function at(e,t){return!t||"object"!==rt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(o,r["bb"]);var t=it(o);function o(e,i){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=t.call(this,i)).type="RockMesh",a.webgl=e,a.options=i;var s=n(35)(a.options.seed);a.size=a.options.size+(s()-.5)*a.options.size*.5,a.geometry=new r.Kb(a.size,4,4);var c=.05*s(),u=.05*s(),l=.05*s(),f=new r.p(.5+c,.4+u,.25+l);return a.material=new r.eb({color:f}),a.castShadow=!0,a.receiveShadow=!0,a}return o}();function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=dt(e);if(t){var o=dt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ht(this,n)}}function ht(e,t){return!t||"object"!==ut(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}ct.requiredLabels=["sand"],ct.labels=["rock"],ct.baseDensity=.1;var bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(s,r["D"]);var t,o,i,a=pt(s);function s(e,t){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var i=Date.now();(o=a.call(this,t)).webgl=e,o.options=t,o.type="Diorama",void 0!==o.options.diorama.seed&&null!==o.options.diorama.seed||(o.options.diorama.seed=0),console.log("Creating new diorama (seed=".concat(t.diorama.seed,", bounds=[").concat(t.diorama.bounds.x,", ").concat(t.diorama.bounds.y,", ").concat(t.diorama.bounds.z,"])"));var c=o.options.diorama.bounds.x/2,u=o.options.diorama.bounds.z/2,l=new r.e(new r.Vb(-c,-u),new r.Vb(c,u));o.options.diorama.contextQuadtree=new nt(l),o.setupLights();var f=n(35);if(o.rng=f(o.options.diorama.seed),o.terrain=new Me(o.webgl,o.options.diorama),o.add(o.terrain),o.water=null,!0===o.options.diorama.water.enabled&&(o.water=new Je(o.webgl,o.options.diorama,o.terrain.waterCurve),o.add(o.water),window.DEBUG)){var p=o.terrain.waterCurve.getPoints(10),h=(new r.j).setFromPoints(p),d=new r.N({color:16711935}),b=new r.L(h,d);o.add(b)}var y={bounds:o.options.diorama.bounds,density:o.options.diorama.buildings};o.distributeObjects(je,y,o.terrain);var m={density:o.options.diorama.vegetation,height:4};o.distributeObjects(Ge,m,o.terrain);var v={density:o.options.diorama.vegetation,size:1};if(o.distributeObjects(ct,v,o.terrain),o.createBase(),window.DEBUG){var w=new r.h(o.options.diorama.bounds.x,o.options.diorama.bounds.y,o.options.diorama.bounds.z),g=new r.bc(w);o.wireframe=new r.P(g),o.wireframe.material.depthTest=!0,o.wireframe.material.opacity=.2,o.wireframe.material.transparent=!0,o.add(o.wireframe)}var O=Date.now()-i;return console.log("Generated in ".concat(O/1e3,"s")),o}return t=s,(o=[{key:"update",value:function(e,t){}},{key:"setupLights",value:function(){this.skylight=new r.F(16777215,16777215,.6),this.skylight.color.setHSL(.6,1,.6),this.skylight.groundColor.setHSL(.095,1,.75),this.skylight.position.set(0,50,0),this.add(this.skylight);var e=Math.max(this.options.diorama.bounds.x,this.options.diorama.bounds.y,this.options.diorama.bounds.z)/2;if(this.sun=new r.v(16777215,1),this.sun.color.setHSL(.1,1,.95),this.sun.position.set(.7,1,.6),this.sun.position.multiplyScalar(e),this.sun.castShadow=!0,this.sun.shadow.mapSize.width=2048,this.sun.shadow.mapSize.height=2048,this.sun.shadow.camera.left=1.5*-e,this.sun.shadow.camera.right=1.5*e,this.sun.shadow.camera.top=1.5*e,this.sun.shadow.camera.bottom=1.5*-e,this.sun.shadow.camera.near=.1,this.sun.shadow.camera.far=3*e,this.add(this.sun),window.DEBUG){var t=new r.k(this.sun.shadow.camera);this.add(t)}this.sky=new Ke.a,this.sky.scale.setScalar(1e3),this.add(this.sky);var n=this.sky.material.uniforms;n.turbidity.value=10,n.rayleigh.value=2,n.mieCoefficient.value=.005,n.mieDirectionalG.value=.8,this.sky.material.uniforms.sunPosition.value.copy(this.sun.position);var o=new r.nb(this.webgl.renderer);this.webgl.scene.environment=o.fromScene(this.sky).texture}},{key:"createBase",value:function(){var e=new r.h(this.options.diorama.bounds.x+4,2,this.options.diorama.bounds.z+4),t=new r.eb({color:new r.p(.4,.4,.4)}),n=new r.bb(e,t);n.translateY(-this.options.diorama.bounds.y/2-1),n.castShadow=!0,n.receiveShadow=!0,this.add(n);var o=2*Math.max(this.options.diorama.bounds.x,this.options.diorama.bounds.z),i=new r.rb(o,o);i.rotateX(-Math.PI/2),i.translate(0,-this.options.diorama.bounds.y/2-2,0);var a=new r.Gb({opacity:.25}),s=new r.bb(i,a);s.receiveShadow=!0,this.add(s)}},{key:"distributeObjects",value:function(e,t,o){var i=(new r.f).setFromObject(o),a=(i.max.x-i.min.x)*(i.max.z-i.min.z)*t.density;hasOwnProperty.call(e,"baseDensity")&&(a*=e.baseDensity);for(var s=n(35)(e.prototype.constructor.name+this.options.diorama.seed),c=new r.Cb,u=0;u<a;u++){t.seed=this.options.diorama.seed+u;var l=new r.Wb(s(),0,s());l.multiply((new r.Wb).subVectors(i.max,i.min)),l.add(new r.Wb(-.5,1,-.5).multiply(this.options.diorama.bounds)),c.set(l,new r.Wb(0,-1,0));var f=c.intersectObjects(this.children,!0),p=16711680;if(f.length>0&&(p=255,f[0].object===this.terrain.mesh)){if(p=65280,l=f[0].point,hasOwnProperty.call(e,"requiredLabels"))if(!1===this.options.diorama.contextQuadtree.positionHasLabels(l,e.requiredLabels))continue;var h=new e(this.webgl,t);if(h.position.set(l.x,l.y,l.z),h.updateMatrixWorld(),this.add(h),hasOwnProperty.call(e,"labels")){var d=new r.Vb(l.x,l.z);e.labels.length>0?this.options.diorama.contextQuadtree.addLabels(e.labels,d):console.warn("No labels defined for class ".concat(h.type))}else console.warn("Failed to find labels property on class ".concat(h.type))}if(window.DEBUG){var b=new r.b(c.ray.direction,c.ray.origin,1.5*this.options.diorama.bounds.y,p,1,.5);this.add(b)}}}}])&&lt(t.prototype,o),i&&lt(t,i),s}();n(258);var yt=n(103),mt=n.n(yt);function vt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Pt(e);if(t){var o=Pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return St(this,n)}}function St(e,t){return!t||"object"!==gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pt(e){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t,n){return t&&_t(e.prototype,t),n&&_t(e,n),e}var Rt={options:{seed:{max:1e4},buildings:{max:1,step:.01},vegetation:{max:1,step:.01}},bounds:{x:{min:5,max:60},y:{min:5,max:30},z:{min:5,max:60}},water:{level:{max:1,step:.01},depth:{max:10,step:.5},width:{min:.5,max:20,step:.5},falloff:{min:.5,max:20,step:.5}},sand:{width:{max:10,step:.5},falloff:{max:10,step:.5}}},Dt=function(){function e(t,n){var r=this;kt(this,e),this.owner=t,this.options=n,this.field=document.createElement("div"),this.label=document.createElement("label"),this.label.innerText=zt(n.name),this.field.appendChild(this.label),this.input=document.createElement("input"),this.input.onchange=function(){return r.propertyChanged()},this.field.appendChild(this.input),n.parent.appendChild(this.field)}return Et(e,[{key:"propertyChanged",value:function(){this.owner.propertyChanged()}},{key:"setVisibility",value:function(e){this.field.style.display=e?"block":"none"}}]),e}(),Ct=function(e){Ot(n,Dt);var t=jt(n);function n(e,r){var o;return kt(this,n),(o=t.call(this,e,r)).input.setAttribute("type","checkbox"),o.input.checked=1==r.defaultValue,o}return Et(n,[{key:"getValue",value:function(){return this.input.checked}}]),n}(),Lt=function(e){Ot(n,Dt);var t=jt(n);function n(e,r){var o;return kt(this,n),(o=t.call(this,e,r)).input.setAttribute("type","range"),o.input.setAttribute("min",r.min),o.input.setAttribute("max",r.max),o.input.setAttribute("step",r.step),o.input.value=r.defaultValue,o}return Et(n,[{key:"getValue",value:function(){return parseFloat(this.input.value)}}]),n}(),Vt=function(){function e(t,n){kt(this,e),this.owner=t,this.options=n,this.div=document.createElement("div"),this.heading=document.createElement("h"+n.depth),this.heading.innerText=zt(n.name),this.div.appendChild(this.heading),this.controls={};for(var r=0,o=Object.entries(n.optionsObject);r<o.length;r++){var i=vt(o[r],2),a=i[0],s=i[1],c={name:a,defaultValue:s,parent:this.div};switch(gt(s)){case"boolean":this.controls[a]=new Ct(this,c);break;case"number":Object.assign(c,{min:0,max:100,step:1}),n.name in Rt&&a in Rt[n.name]&&Object.assign(c,Rt[n.name][a]),this.controls[a]=new Lt(this,c);break;case"object":!1===mt()(s)&&(Object.assign(c,{optionsObject:s,depth:n.depth+1}),this.controls[a]=new e(this,c))}}n.parent.appendChild(this.div)}return Et(e,[{key:"propertyChanged",value:function(){"enabled"in this.controls&&this.setVisibility(this.controls.enabled.getValue()),this.owner.propertyChanged()}},{key:"getValue",value:function(){for(var e={},t=0,n=Object.entries(this.controls);t<n.length;t++){var r=vt(n[t],2),o=r[0],i=r[1];e[o]=i.getValue()}return e}},{key:"setVisibility",value:function(e){for(var t=0,n=Object.entries(this.controls);t<n.length;t++){var r=vt(n[t],2),o=r[0];r[1];"enabled"!==o&&this.controls[o].setVisibility(e)}}}]),e}(),Tt=function(){function e(t,n){kt(this,e),this.webgl=t,this.options=n;var r=document.getElementById("controls");this.controls=new Vt(this,{name:"options",optionsObject:this.options,depth:1,parent:r})}return Et(e,[{key:"propertyChanged",value:function(){void 0!==this.webgl.scene.diorama&&(this.webgl.scene.remove(this.webgl.scene.diorama),this.webgl.scene.diorama=void 0);var e=this.controls.getValue();sessionStorage.setItem("dioramaOptions",JSON.stringify(e)),this.webgl.scene.diorama=new bt(this.webgl,{diorama:e}),this.webgl.scene.add(this.webgl.scene.diorama)}}]),e}();function zt(e){return mt()(e)?e:e[0].toUpperCase()+e.slice(1)}window.DEBUG=window.location.search.includes("debug");var Mt=new R({canvas:document.querySelector("#app"),alpha:!0,background:"#222",backgroundAlpha:1,showFps:window.DEBUG,orbitControls:!0});window.DEBUG&&(window.webgl=Mt);var At=function(){var e={seed:5e3,bounds:new r.Wb(48,16,32),biome:"temperate",buildings:.1,vegetation:.4,water:{enabled:!0,level:.25,depth:1,width:2,falloff:6,sand:{enabled:!0,width:1,falloff:2}}},t=sessionStorage.getItem("dioramaOptions");if(null!==t){var n={};try{n=JSON.parse(t)}catch(e){console.log("Error when parsing session options!")}Object.assign(e,n)}return e}();new Tt(Mt,At),Mt.canvas.style.visibility="hidden",me.load({renderer:Mt.renderer}).then(function(){Mt.scene.diorama=new bt(Mt,{diorama:At}),Mt.scene.add(Mt.scene.diorama),Mt.canvas.style.visibility="",Mt.orbitControls.target.set(0,-At.bounds.y/5,0),Mt.start(),Mt.draw()})}});
//# sourceMappingURL=app.5873f092.js.map